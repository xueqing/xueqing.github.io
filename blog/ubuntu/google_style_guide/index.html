<!DOCTYPE html>
<html lang="zh-Hans">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.5.0">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="kiki">

  
  
  
    
  
  <meta name="description" content="参考 shell 风格指南 背景 shell 文件和解释器调用 环境 注释 格式 缩进 行的长度和长字符串 管道 循环 case 语句 变量扩展 引用 特性及错误 命令替换 [test,[和[[](#">

  
  <link rel="alternate" hreflang="zh-Hans" href="https://xueqing.github.io/blog/ubuntu/google_style_guide/">

  


  
  
  
  <meta name="theme-color" content="#ff3860">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    

    

  

  
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700%7CRoboto:400,400italic,700%7CRoboto+Mono&display=swap">
  

  
  
  
  
  <link rel="stylesheet" href="/css/academic.css">

  




  


  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon-32.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="https://xueqing.github.io/blog/ubuntu/google_style_guide/">

  
  
  
  
    
    
  
  
  <meta property="twitter:card" content="summary">
  
  <meta property="og:site_name" content="kiki">
  <meta property="og:url" content="https://xueqing.github.io/blog/ubuntu/google_style_guide/">
  <meta property="og:title" content="Google 开源项目风格指南 | kiki">
  <meta property="og:description" content="参考 shell 风格指南 背景 shell 文件和解释器调用 环境 注释 格式 缩进 行的长度和长字符串 管道 循环 case 语句 变量扩展 引用 特性及错误 命令替换 [test,[和[[](#"><meta property="og:image" content="https://xueqing.github.io/img/icon-192.png">
  <meta property="twitter:image" content="https://xueqing.github.io/img/icon-192.png"><meta property="og:locale" content="zh-Hans">
  
    
    
  

  



  


  


  





  <title>Google 开源项目风格指南 | kiki</title>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>搜索</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="搜索..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  
<nav class="navbar navbar-light fixed-top navbar-expand-lg py-0 compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
      <a class="navbar-brand" href="/">kiki</a>
      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="切换导航">
        <span><i class="fas fa-bars"></i></span>
      </button>
      

    
    <div class="collapse navbar-collapse" id="navbar">

      
      
      <ul class="navbar-nav mr-auto">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#about"><span>主页</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link  active" href="/blog/"><span>博客</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/translation/"><span>翻译</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/reading/"><span>阅读</span></a>
        </li>

        
        

      
      </ul>
      <ul class="navbar-nav ml-auto">
      

        

        
        <li class="nav-item">
          <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        

        
        <li class="nav-item">
          <a class="nav-link js-dark-toggle" href="#"><i class="fas fa-moon" aria-hidden="true"></i></a>
        </li>
        

      </ul>

    </div>
  </div>
</nav>


  <article class="article">

  












  

  
  
  
<div class="article-container pt-3">
  <h1>Google 开源项目风格指南</h1>

  

  
    


<div class="article-metadata">

  
  
  
  
  <div>
    



  
  <span><a href="/authors/kiki/">kiki</a></span>

  </div>
  
  

  
  <span class="article-date">
    
    
      
    
    Jan 1, 0001
  </span>
  

  

  

  
  
  

  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fas fa-folder mr-1"></i><a href="/categories/blog/">blog</a></span>
  

</div>

    














  
</div>



  <div class="article-container">

    <div class="article-style">
      

<p><a href="https://zh-google-styleguide.readthedocs.io/en/latest/contents/" target="_blank">参考</a></p>

<ul>
<li><a href="#shell-%e9%a3%8e%e6%a0%bc%e6%8c%87%e5%8d%97">shell 风格指南</a>

<ul>
<li><a href="#%e8%83%8c%e6%99%af">背景</a></li>
<li><a href="#shell-%e6%96%87%e4%bb%b6%e5%92%8c%e8%a7%a3%e9%87%8a%e5%99%a8%e8%b0%83%e7%94%a8">shell 文件和解释器调用</a></li>
<li><a href="#%e7%8e%af%e5%a2%83">环境</a></li>
<li><a href="#%e6%b3%a8%e9%87%8a">注释</a></li>
<li><a href="#%e6%a0%bc%e5%bc%8f">格式</a></li>
<li><a href="#%e7%bc%a9%e8%bf%9b">缩进</a></li>
<li><a href="#%e8%a1%8c%e7%9a%84%e9%95%bf%e5%ba%a6%e5%92%8c%e9%95%bf%e5%ad%97%e7%ac%a6%e4%b8%b2">行的长度和长字符串</a></li>
<li><a href="#%e7%ae%a1%e9%81%93">管道</a></li>
<li><a href="#%e5%be%aa%e7%8e%af">循环</a></li>
<li><a href="#case-%e8%af%ad%e5%8f%a5">case 语句</a></li>
<li><a href="#%e5%8f%98%e9%87%8f%e6%89%a9%e5%b1%95">变量扩展</a></li>
<li><a href="#%e5%bc%95%e7%94%a8">引用</a></li>
<li><a href="#%e7%89%b9%e6%80%a7%e5%8f%8a%e9%94%99%e8%af%af">特性及错误</a></li>
<li><a href="#%e5%91%bd%e4%bb%a4%e6%9b%bf%e6%8d%a2">命令替换</a></li>
<li>[<code>test</code>,<code>[</code>和<code>[[</code>](#test%e5%92%8c)</li>
<li><a href="#%e6%b5%8b%e8%af%95%e5%ad%97%e7%ac%a6%e4%b8%b2">测试字符串</a></li>
<li><a href="#%e6%96%87%e4%bb%b6%e5%90%8d%e7%9a%84%e9%80%9a%e9%85%8d%e7%ac%a6%e6%89%a9%e5%b1%95">文件名的通配符扩展</a></li>
<li><a href="#eval">eval</a></li>
<li><a href="#%e7%ae%a1%e9%81%93%e5%af%bc%e5%90%91-while-%e5%be%aa%e7%8e%af">管道导向 while 循环</a></li>
<li><a href="#%e5%91%bd%e5%90%8d%e7%ba%a6%e5%ae%9a">命名约定</a></li>
<li><a href="#%e5%87%bd%e6%95%b0%e5%90%8d">函数名</a></li>
<li><a href="#%e5%8f%98%e9%87%8f%e5%90%8d">变量名</a></li>
<li><a href="#%e5%b8%b8%e9%87%8f%e5%92%8c%e7%8e%af%e5%a2%83%e5%8f%98%e9%87%8f%e5%90%8d">常量和环境变量名</a></li>
<li><a href="#%e6%ba%90%e6%96%87%e4%bb%b6%e5%90%8d">源文件名</a></li>
<li><a href="#%e5%8f%aa%e8%af%bb%e5%8f%98%e9%87%8f">只读变量</a></li>
<li><a href="#%e4%bd%bf%e7%94%a8%e6%9c%ac%e5%9c%b0%e5%8f%98%e9%87%8f">使用本地变量</a></li>
<li><a href="#%e5%87%bd%e6%95%b0%e4%bd%8d%e7%bd%ae">函数位置</a></li>
<li><a href="#%e4%b8%bb%e5%87%bd%e6%95%b0-main">主函数 main</a></li>
<li><a href="#%e8%b0%83%e7%94%a8%e5%91%bd%e4%bb%a4">调用命令</a></li>
</ul></li>
<li><a href="#c-%e9%a3%8e%e6%a0%bc%e6%8c%87%e5%8d%97">C++ 风格指南</a></li>

<li><p><a href="#python-%e9%a3%8e%e6%a0%bc%e6%8c%87%e5%8d%97">Python 风格指南</a></p></li>

<li><p><a href="./shell-风格指南">shell 风格指南</a></p></li>

<li><p><a href="./C++-风格指南">C++ 风格指南</a></p></li>

<li><p><a href="./Python-风格指南">Python 风格指南</a></p></li>
</ul>

<h2 id="shell-风格指南-https-zh-google-styleguide-readthedocs-io-en-latest-google-shell-styleguide-contents"><a href="https://zh-google-styleguide.readthedocs.io/en/latest/google-shell-styleguide/contents/" target="_blank">shell 风格指南</a></h2>

<h3 id="背景">背景</h3>

<ul>
<li>使用哪一种 shell

<ul>
<li>bash 是唯一被允许执行的 shell 脚本语言</li>
<li>可执行文件以<code>#!/bin/bash</code>开始</li>
<li>使用<code>set</code>设置 shell 的选项</li>
</ul></li>
<li>什么时候使用 shell

<ul>
<li>仅被用于小功能或简单的包装脚本</li>
<li>如果在乎性能，不使用 shell</li>
<li>需要使用数据而不是变量赋值，如<code>${PHPESTATUS}</code>，使用 Python 脚本</li>
<li>脚本超过 100 行，尽可能使用 Python，以免之后花更多时间重写脚本</li>
</ul></li>
</ul>

<h3 id="shell-文件和解释器调用">shell 文件和解释器调用</h3>

<ul>
<li>文件扩展名

<ul>
<li>可执行文件应该没有扩展名（强烈建议）或使用<code>.sh</code>扩展名</li>
<li>库文件使用<code>.sh</code>扩展名，且不可执行</li>
</ul></li>
<li>SUID/SGID

<ul>
<li>禁止在脚本中使用 SUID(Set User ID) 和 SGID(Set Group ID)</li>
<li>如果需要较高权限使用<code>sudo</code></li>
</ul></li>
</ul>

<h3 id="环境">环境</h3>

<ul>
<li><p>STDOUT vs STDERR</p>

<ul>
<li>所有错误信息应导向 STDERR</li>
<li>便于从实际问题中分离出正常状态</li>

<li><p>推荐使用如下函数，打印错误信息和其他状态信息</p>

<pre><code class="language-shell">err() {
echo &quot;[$(date +'%Y-%m-%dT%H:%M:%S%z')]: $@&quot; &gt;&amp;2
}

if ! do_sth; then
err &quot;Unable to do_sth&quot;
exit &quot;${E_DID_NOTHING}&quot;
fi
</code></pre></li>
</ul></li>
</ul>

<h3 id="注释">注释</h3>

<ul>
<li><p>文件头</p>

<ul>
<li>文件必须包含一个顶层注释，简要概述内容。版权声明和作者信息可选</li>

<li><p>例如</p>

<pre><code class="language-shell">#!/bin/bash
#
# Perform hot bakeups of Oracle databases.
</code></pre></li>
</ul></li>

<li><p>功能注释</p>

<ul>
<li>除了明显简短的函数必须被注释</li>
<li>库函数都必须注释</li>
<li>注释包括</li>
<li>函数的描述</li>
<li>全局变量的使用和修改</li>
<li>使用的参数说明</li>
<li>返回值，而不是上一条命令运行后默认的退出状态</li>

<li><p>例如</p>

<pre><code class="language-shell">#!/bin/bash
#
# Perform hot bakeups of Oracle databases.

export PATH='/usr/xpg4/bin:/usr/bin:/opt/csw/bin:/opt/goog/bin'

#######################################
# Cleanup files from the backup dir
# Globals:
#   BACKUP_DIR
#   ORACLE_SID
# Arguments:
#   None
# Returns:
#   None
#######################################
cleanup() {
#...
}
</code></pre></li>
</ul></li>

<li><p>实现部分的注释</p>

<ul>
<li>注释代码中有技巧、不明显、有趣或重要的部分</li>
<li>不要注释所有代码，简单注释</li>
</ul></li>

<li><p>TODO 注释</p>

<ul>
<li>使用 TODO 注释临时的、短期解决方案的、或足够好但不完美的代码</li>
<li>应包含全部大写的字符串 TODO + 用户名，冒号可选，最好在后面加上 bug 或 ticket 的序号</li>
<li>例如<code># TODO(kiki): Handle the unlikely edge cases (bug ####)</code></li>
</ul></li>
</ul>

<h3 id="格式">格式</h3>

<h4 id="缩进">缩进</h4>

<ul>
<li>缩进两个空格，没有制表符</li>
<li>代码块直接使用空行提升可读性</li>
<li>对于已有文件，保持已有的缩进风格</li>
</ul>

<h4 id="行的长度和长字符串">行的长度和长字符串</h4>

<ul>
<li>行的最大长度为 80 个字符</li>
<li>使用 here document 或嵌入的换行符</li>

<li><p>例如</p>

<pre><code class="language-shell"># DO use 'here document's
cat &lt;&lt;END;
I am an exceptionally long
string.
END

# Embedded newlines are ok too
long_string=&quot;I am an exceptionally
long string.&quot;
</code></pre></li>
</ul>

<h4 id="管道">管道</h4>

<ul>
<li>如果一行容不下一个管道，将正哥管道操作分割成梅钢一个管道</li>
<li>管道操作的下一部分应放在新行且缩进两个空格</li>

<li><p>例如</p>

<pre><code class="language-shell"># All fits on one line
command1 | command2

# Long commands
command1 \
| command2 \
| command3 \
| command4
</code></pre></li>
</ul>

<h4 id="循环">循环</h4>

<ul>
<li>将<code>; do</code>，<code>; then</code>和<code>while</code>，<code>for</code>，<code>if</code>放在同一行</li>
<li><code>else</code>单独成一行</li>
<li>结束语句单独一行并与开始语句垂直对齐</li>

<li><p>例如</p>

<pre><code class="language-shell">for dir in ${dirs_to_cleanup}; do
if [[ -d &quot;${dir}/${ORACLE_SID}&quot; ]]; then
log_date &quot;Cleaning up old files in ${dir}/${ORACLE_SID}&quot;
rm &quot;${dir}/${ORACLE_SID}/&quot;*
if [[ &quot;$?&quot; -ne 0 ]]; then
error_message
fi
else
mkdir -p &quot;${dir}/${ORACLE_SID}&quot;
if [[ &quot;$?&quot; -ne 0 ]]; then
error_message
fi
fi
done
</code></pre></li>
</ul>

<h4 id="case-语句">case 语句</h4>

<ul>
<li>通过 2 个空格缩进可选项</li>
<li>同一行可选项的模式右圆括号知乎和结束符<code>;;</code>之前各一个空格</li>

<li><p>长可选项或多命令可选项应被拆成多行，模式、操作和结束符<code>;;</code>在不同的行</p>

<pre><code class="language-shell"># multi-lines
case &quot;${expression}&quot; in
a)
variable=&quot;...&quot;
some_command &quot;${variable}&quot; &quot;${other_expr}&quot; ...
;;
absolute)
actions=&quot;relative&quot;
another_command &quot;${actions}&quot; &quot;${other_expr}&quot; ...
;;
*)
error &quot;Unexpected expression '${expression}'&quot;
;;
esac

# one-line
verbose='false'
aflag=''
bflag=''
files=''
while getopts 'abf:v' flag; do
case &quot;${flag}&quot; in
a) aflag='true' ;;
b) bflag='true' ;;
f) files=&quot;${OPTARG}&quot; ;;
v) verbose='true' ;;
*) error &quot;Unexpected option ${flag}&quot; ;;
esac
done
</code></pre></li>
</ul>

<h4 id="变量扩展">变量扩展</h4>

<ul>
<li>按照优先级顺序

<ul>
<li>与现存代码发现的保持一致</li>
<li>阅读<a href="#引用">引用变量</a></li>
<li>推荐使用<code>${var}</code>而不是<code>$var</code></li>
</ul></li>

<li><p>例如</p>

<pre><code class="language-shell"># Section of recommended cases.

# Preferred style for 'special' variables:
echo &quot;Positional: $1&quot; &quot;$5&quot; &quot;$3&quot;
echo &quot;Specials: !=$!, -=$-, _=$_. ?=$?, #=$# *=$* @=$@ \$=$$ ...&quot;

# Braces necessary:
echo &quot;many parameters: ${10}&quot;

# Braces avoiding confusion:
# Output is &quot;a0b0c0&quot;
set -- a b c
echo &quot;${1}0${2}0${3}0&quot;

# Preferred style for other variables:
echo &quot;PATH=${PATH}, PWD=${PWD}, mine=${some_var}&quot;
while read f; do
echo &quot;file=${f}&quot;
done &lt; &lt;(ls -l /tmp)

# Section of discouraged cases

# Unquoted vars, unbraced vars, brace-quoted single letter
# shell specials.
echo a=$avar &quot;b=$bvar&quot; &quot;PID=${$}&quot; &quot;${1}&quot;

# Confusing use: this is expanded as &quot;${1}0${2}0${3}0&quot;,
# not &quot;${10}${20}${30}
set -- a b c
echo &quot;$10$20$30&quot;
</code></pre></li>
</ul>

<h4 id="引用">引用</h4>

<ul>
<li>除非需要小心不带引用的扩展，否则总是引用包含变量、命令替换符、空格或 shell 元字符的字符串</li>
<li>推荐引用是单词的字符串(而不是命令选项或者路径名)</li>
<li>不要引用整数</li>
<li>注意<code>[[</code>中模式匹配的引用规则</li>

<li><p>请使用<code>$@</code>除非有特殊原因需要使用<code>S*</code></p>

<pre><code class="language-shell"># 'Single' quotes indicate that no substitution is desired.
# &quot;Double&quot; quotes indicate that substitution is required/tolerated.

# Simple examples
# &quot;quote command substitutions&quot;
flag=&quot;$(some_command and its args &quot;$@&quot; 'quoted separately')&quot;

# &quot;quote variables&quot;
echo &quot;${flag}&quot;

# &quot;never quote literal integers&quot;
value=32
# &quot;quote command substitutions&quot;, even when you expect integers
number=&quot;$(generate_number)&quot;

# &quot;prefer quoting words&quot;, not compulsory
readonly USE_INTEGER='true'

# &quot;quote shell meta characters&quot;
echo 'Hello stranger, and well met. Earn lots of $$$'
echo &quot;Process $$: Done making \$\$\$.&quot;

# &quot;command options or path names&quot;
# ($1 is assumed to contain a value here)
grep -li Hugo /dev/null &quot;$1&quot;

# Less simple examples
# &quot;quote variables, unless proven false&quot;: ccs might be empty
git send-email --to &quot;${reviewers}&quot; ${ccs:+&quot;--cc&quot; &quot;${ccs}&quot;}

# Positional parameter precautions: $1 might be unset
# Single quotes leave regex as-is.
grep -cP '([Ss]pecial|\|?characters*)$' ${1:+&quot;$1&quot;}

# For passing on arguments,
# &quot;$@&quot; is right almost everytime, and
# $* is wrong almost everytime:
#
# * $* and $@ will split on spaces, clobbering up arguments
#   that contain spaces and dropping empty strings;
# * &quot;$@&quot; will retain arguments as-is, so no args
#   provided will result in no args being passed on;
#   This is in most cases what you want to use for passing
#   on arguments.
# * &quot;$*&quot; expands to one argument, with all args joined
#   by (usually) spaces,
#   so no args provided will result in one empty string
#   being passed on.
# (Consult 'man bash' for the nit-grits ;-)

set -- 1 &quot;2 two&quot; &quot;3 three tres&quot;; echo $# ; set -- &quot;$*&quot;; echo &quot;$#, $@&quot;)
set -- 1 &quot;2 two&quot; &quot;3 three tres&quot;; echo $# ; set -- &quot;$@&quot;; echo &quot;$#, $@&quot;)
</code></pre></li>
</ul>

<h3 id="特性及错误">特性及错误</h3>

<h4 id="命令替换">命令替换</h4>

<ul>
<li>使用<code>${command}</code>而不是反引号</li>
<li>嵌套的反引号要求用反斜杠转义内部的反引号，而<code>${command}</code>形式嵌套时不需要改变，易于阅读</li>

<li><p>例如</p>

<pre><code class="language-shell"># This is preferred:
var=&quot;$(command &quot;$(command1)&quot;)&quot;

# This is not:
var=&quot;`command \`command1\``&quot;
</code></pre></li>
</ul>

<h4 id="test-和"><code>test</code>,<code>[</code>和<code>[[</code></h4>

<ul>
<li>推荐使用<code>[[ ... ]]</code>，而不是<code>[</code>，<code>test</code>和<code>/usr/bin [</code></li>
<li>在<code>[[ ... ]]</code>之间不会有路径名称扩展或单词分割发生，且允许正则表达式匹配</li>

<li><p>例如</p>

<pre><code class="language-shell"># This ensures the string on the left is made up of characters in the
# alnum character class followed by the string name.
# Note that the RHS should not be quoted here.
# For the gory details, see
# E14 at http://tiswww.case.edu/php/chet/bash/FAQ
if [[ &quot;filename&quot; =~ ^[[:alnum:]]+name ]]; then
echo &quot;Match&quot;
fi

# This matches the exact pattern &quot;f*&quot; (Does not match in this case)
if [[ &quot;filename&quot; == &quot;f*&quot; ]]; then
echo &quot;Match&quot;
fi

# This gives a &quot;too many arguments&quot; error as f* is expanded to the
# contents of the current directory
if [ &quot;filename&quot; == f* ]; then
echo &quot;Match&quot;
fi
</code></pre></li>
</ul>

<h4 id="测试字符串">测试字符串</h4>

<ul>
<li>尽可能使用引用，而不是过滤字符串</li>
<li>使用空<code>-z</code>或非空<code>-n</code>字符串测试，而不是过滤字符串</li>

<li><p>例如</p>

<pre><code class="language-shell"># Do this:
if [[ &quot;${my_var}&quot; = &quot;some_string&quot; ]]; then
do_something
fi

# -z (string length is zero) and -n (string length is not zero) are
# preferred over testing for an empty string
if [[ -z &quot;${my_var}&quot; ]]; then
do_something
fi

# This is OK (ensure quotes on the empty side), but not preferred:
if [[ &quot;${my_var}&quot; = &quot;&quot; ]]; then
do_something
fi

# Not this:
if [[ &quot;${my_var}X&quot; = &quot;some_stringX&quot; ]]; then
do_something
fi

# Use this
if [[ -n &quot;${my_var}&quot; ]]; then
do_something
fi

# Instead of this as errors can occur if ${my_var} expands to a test
# flag
if [[ &quot;${my_var}&quot; ]]; then
do_something
fi
</code></pre></li>
</ul>

<h4 id="文件名的通配符扩展">文件名的通配符扩展</h4>

<ul>
<li>使用明确的路径</li>
<li>文件名可能以<code>-</code>开头，使用扩展通配符<code>./*</code>比<code>*</code>更安全</li>

<li><p>例如</p>

<pre><code class="language-shell"># Here's the contents of the directory:
# -f  -r  somedir  somefile

# This deletes almost everything in the directory by force
rm -v *
#removed directory: `somedir'
#removed `somefile'

# As opposed to:
rm -v ./*
#removed `./-f'
#removed `./-r'
#rm: cannot remove `./somedir': Is a directory
#removed `./somefile'
</code></pre></li>
</ul>

<h4 id="eval">eval</h4>

<ul>
<li>避免使用 eval</li>
<li>当用于给变量赋值时，eval 解析输入，并能够设置变量，但无法检查变量是什么</li>

<li><p>例如</p>

<pre><code class="language-shell"># What does this set?
# Did it succeed? In part or whole?
eval $(set_my_variables)

# What happens if one of the returned values has a space in it?
variable=&quot;$(eval some_function)&quot;
</code></pre></li>
</ul>

<h4 id="管道导向-while-循环">管道导向 while 循环</h4>

<ul>
<li>使用过程替换或 for 虚幻，而不是管道导向 while 循环</li>

<li><p>在 while 循环中被修改的变量不能传递给父 shell，因为循环命令是在一个子 shell 中运行的</p>

<pre><code class="language-shell">last_line='NULL'
your_command | while read line; do
last_line=&quot;${line}&quot;
done

# This will output 'NULL'
echo &quot;${last_line}&quot;
</code></pre></li>

<li><p>如果确定输入中不包含空格或特殊符号，可使用一个 for 循环</p>

<pre><code class="language-shell">total=0
# Only do this if there are no spaces in return values.
for value in $(command); do
total+=&quot;${value}&quot;
done
</code></pre></li>

<li><p>使用过程替换允许重定向输出，但是请将命令放入一个显式的子 shell 中，而不是 bash 为 while 循环创建的隐式子 shell</p>

<pre><code class="language-shell">total=0
last_file=
while read count filename; do
total+=&quot;${count}&quot;
last_file=&quot;${filename}&quot;
done &lt; &lt;(your_command | uniq -c)

# This will output the second field of the last line of output from
# the command.
echo &quot;Total = ${total}&quot;
echo &quot;Last one = ${last_file}&quot;
</code></pre></li>

<li><p>当不需要传递复杂的结果给父 shell 时可使用 while 循环，当不希望改变父 shell 的范围变量时也是有用的</p>

<pre><code class="language-shell"># Trivial implementation of awk expression:
#   awk '$3 == &quot;nfs&quot; { print $2 &quot; maps to &quot; $1 }' /proc/mounts
cat /proc/mounts | while read src dest type opts rest; do
if [[ ${type} == &quot;nfs&quot; ]]; then
echo &quot;NFS ${dest} maps to ${src}&quot;
fi
done
</code></pre></li>
</ul>

<h3 id="命名约定">命名约定</h3>

<h4 id="函数名">函数名</h4>

<ul>
<li>使用小写字符，用下划线分割单词，使用双冒号<code>::</code>分割库</li>
<li>函数名之后必须有圆括号。关键词<code>function</code>可选，但必须在一个项目中保持一致

<ul>
<li>函数名之后有括号时，关键词<code>function</code>是多余的，但是促进了函数的快速辨识</li>
</ul></li>
<li>大括号和函数名位于同一行，且函数名和圆括号之间没有空格</li>

<li><p>例如</p>

<pre><code class="language-shell"># Single function
my_func() {
#...
}

# Part of a package
mypackage::my_func() {
#...
}
</code></pre></li>
</ul>

<h4 id="变量名">变量名</h4>

<ul>
<li>如<a href="#函数名">函数名</a></li>
<li>循环的变量名应该和循环的任何变量同样命名</li>

<li><p>例如</p>

<pre><code class="language-shell">for zone in ${zones}; do
something_with &quot;${zone}&quot;
done
</code></pre></li>
</ul>

<h4 id="常量和环境变量名">常量和环境变量名</h4>

<ul>
<li>全部大写，用下划线分割，声明在文件的顶部</li>
<li>有的第一次设置就变成了常量(如通过 getopts)，所以可以在 getopts 或基于条件来设定常量，但之后应立即设置为只读</li>

<li><p>在函数中<code>declare</code>不会对全局变量进行操作，所以推荐使用<code>readonly</code>和<code>export</code></p>

<pre><code class="language-shell"># Constant
readonly PATH_TO_FILES='/some/path'

# Both constant and environment
declare -xr ORACLE_SID='PROD'

VERBOSE='false'
while getopts 'v' flag; do
case &quot;${flag}&quot; in
v) VERBOSE='true' ;;
esac
done
readonly VERBOSE
</code></pre></li>
</ul>

<h4 id="源文件名">源文件名</h4>

<ul>
<li>小写，可使用下划线分割单词</li>
</ul>

<h4 id="只读变量">只读变量</h4>

<ul>
<li>使用<code>readonly</code>或<code>declare -r</code>确保变量只读</li>

<li><p>因为全局变量在 shell 中广泛使用，所以在使用过程中捕获错误很重要。明确只读变量</p>

<pre><code class="language-shell">zip_version=&quot;$(dpkg --status zip | grep Version: | cut -d ' ' -f 2)&quot;
if [[ -z &quot;${zip_version}&quot; ]]; then
error_message
else
readonly zip_version
fi
</code></pre></li>
</ul>

<h4 id="使用本地变量">使用本地变量</h4>

<ul>
<li>使用<code>local</code>声明特定功能的变量，可以确保只在函数内部和子函数中可见，避免了污染全局命名空间</li>
<li>当赋值的值由命令替换提供时，声明和赋值需分开。因为内建的<code>local</code>命令不会从命令替换中传递退出码</li>

<li><p>例如</p>

<pre><code class="language-shell">my_func2() {
local name=&quot;$1&quot;

# Separate lines for declaration and assignment:
local my_var
my_var=&quot;$(my_func)&quot; || return

# DO NOT do this: $? contains the exit code of 'local', not my_func
local my_var=&quot;$(my_func)&quot;
[[ $? -eq 0 ]] || return
}
</code></pre></li>
</ul>

<h4 id="函数位置">函数位置</h4>

<ul>
<li>将文件中所有函数一起放在常量下面，不要在函数直接隐藏可执行代码</li>
<li>只有<code>includes</code>，<code>set</code>声明和常量设置可能在函数声明之前完成</li>
</ul>

<h4 id="主函数-main">主函数 main</h4>

<ul>
<li>对于包含至少一个其他函数的足够长的脚本，需要称为<code>main</code>的函数</li>
<li>便于查找程序的开始，同时允许定义更多变量为局部变量</li>
<li>文件中最后的非注释行应该是对<code>main</code>函数的调用<code>main &quot;$@&quot;</code></li>
</ul>

<h3 id="调用命令">调用命令</h3>

<ul>
<li><p>检查返回值</p>

<ul>
<li>总是检查返回值，并给出信息返回值</li>
<li>对于非管道命令，使用<code>$?</code>或直接通过一个<code>if</code>语句来检查以保持简洁</li>

<li><p>例如</p>

<pre><code class="language-shell">if ! mv &quot;${file_list}&quot; &quot;${dest_dir}/&quot; ; then
echo &quot;Unable to move ${file_list} to ${dest_dir}&quot; &gt;&amp;2
exit &quot;${E_BAD_MOVE}&quot;
fi
  
# Or
mv &quot;${file_list}&quot; &quot;${dest_dir}/&quot;
if [[ &quot;$?&quot; -ne 0 ]]; then
echo &quot;Unable to move ${file_list} to ${dest_dir}&quot; &gt;&amp;2
exit &quot;${E_BAD_MOVE}&quot;
fi
</code></pre></li>

<li><p>bash 也有<code>PIPESTATUS</code>变量，允许检查从管道所有部分返回的代码</p></li>

<li><p>如果仅仅检查整个管道成功还是失败，可用下面的方法</p>

<pre><code class="language-shell">tar -cf - ./* | ( cd &quot;${dir}&quot; &amp;&amp; tar -xf - )
if [[ &quot;${PIPESTATUS[0]}&quot; -ne 0 || &quot;${PIPESTATUS[1]}&quot; -ne 0 ]]; then
echo &quot;Unable to tar files to ${dir}&quot; &gt;&amp;2
fi
</code></pre></li>

<li><p>只要运用任何其他命令，<code>PIPESTATUS</code>会被覆盖。如果需要机遇管道中发生的错误执行不同的操作，需要在运行命令后立即将<code>PIPESTATUS</code>赋值给另一个变量，<code>[</code>是一个会将<code>PIPESTATUS</code>擦出的命令</p></li>

<li><p>例如</p>

<pre><code class="language-shell">tar -cf - ./* | ( cd &quot;${DIR}&quot; &amp;&amp; tar -xf - )
return_codes=(${PIPESTATUS[*]})
if [[ &quot;${return_codes[0]}&quot; -ne 0 ]]; then
do_something
fi
if [[ &quot;${return_codes[1]}&quot; -ne 0 ]]; then
do_something_else
fi
</code></pre></li>
</ul></li>

<li><p>内建命令和外部命令</p>

<ul>
<li>在调用 shell 内建命令和调用另外的程序之间选择，选择内建命令</li>
<li>例如在<code>bash(1)</code>中参数扩展函数，内建函数更强健和便携，尤其是跟<code>sed</code>这样的命令比较</li>

<li><p>例如</p>

<pre><code class="language-shell"># Prefer this:
addition=$((${X} + ${Y}))
substitution=&quot;${string/#foo/bar}&quot;
  
# Instead of this:
addition=&quot;$(expr ${X} + ${Y})&quot;
substitution=&quot;$(echo &quot;${string}&quot; | sed -e 's/^foo/bar/')&quot;
</code></pre></li>
</ul></li>
</ul>

<h2 id="c-风格指南-https-zh-google-styleguide-readthedocs-io-en-latest-google-cpp-styleguide-contents"><a href="https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/contents/" target="_blank">C++ 风格指南</a></h2>

<h2 id="python-风格指南-https-zh-google-styleguide-readthedocs-io-en-latest-google-python-styleguide-contents"><a href="https://zh-google-styleguide.readthedocs.io/en/latest/google-python-styleguide/contents/" target="_blank">Python 风格指南</a></h2>

    </div>

    





<div class="article-tags">
  
  <a class="badge badge-light" href="/tags/ubuntu/">ubuntu</a>
  
  <a class="badge badge-light" href="/tags/linux/">linux</a>
  
</div>



<div class="share-box" aria-hidden="true">
  <ul class="share">
    
      
      
      
        
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=https://xueqing.github.io/blog/ubuntu/google_style_guide/&amp;text=Google%20%e5%bc%80%e6%ba%90%e9%a1%b9%e7%9b%ae%e9%a3%8e%e6%a0%bc%e6%8c%87%e5%8d%97" target="_blank" rel="noopener" class="share-btn-twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=https://xueqing.github.io/blog/ubuntu/google_style_guide/&amp;t=Google%20%e5%bc%80%e6%ba%90%e9%a1%b9%e7%9b%ae%e9%a3%8e%e6%a0%bc%e6%8c%87%e5%8d%97" target="_blank" rel="noopener" class="share-btn-facebook">
          <i class="fab fa-facebook-f"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="mailto:?subject=Google%20%e5%bc%80%e6%ba%90%e9%a1%b9%e7%9b%ae%e9%a3%8e%e6%a0%bc%e6%8c%87%e5%8d%97&amp;body=https://xueqing.github.io/blog/ubuntu/google_style_guide/" target="_blank" rel="noopener" class="share-btn-email">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=https://xueqing.github.io/blog/ubuntu/google_style_guide/&amp;title=Google%20%e5%bc%80%e6%ba%90%e9%a1%b9%e7%9b%ae%e9%a3%8e%e6%a0%bc%e6%8c%87%e5%8d%97" target="_blank" rel="noopener" class="share-btn-linkedin">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://web.whatsapp.com/send?text=Google%20%e5%bc%80%e6%ba%90%e9%a1%b9%e7%9b%ae%e9%a3%8e%e6%a0%bc%e6%8c%87%e5%8d%97%20https://xueqing.github.io/blog/ubuntu/google_style_guide/" target="_blank" rel="noopener" class="share-btn-whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://service.weibo.com/share/share.php?url=https://xueqing.github.io/blog/ubuntu/google_style_guide/&amp;title=Google%20%e5%bc%80%e6%ba%90%e9%a1%b9%e7%9b%ae%e9%a3%8e%e6%a0%bc%e6%8c%87%e5%8d%97" target="_blank" rel="noopener" class="share-btn-weibo">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
    
  </ul>
</div>












  
  
    
  
  






  
  
  
  
  <div class="media author-card content-widget-hr">
    

    <div class="media-body">
      <h5 class="card-title"><a href="/authors/kiki/"></a></h5>
      
      
      <ul class="network-icon" aria-hidden="true">
  
</ul>

    </div>
  </div>









  
  
  <div class="article-widget content-widget-hr">
    <h3>相关</h3>
    <ul>
      
      <li><a href="/blog/ubuntu/gdb/">GDB 学习</a></li>
      
      <li><a href="/blog/ubuntu/ubuntu_nodejs/">Node.js 环境搭建</a></li>
      
      <li><a href="/blog/ubuntu/openssl_version_mismatch/">OpenSSL 版本不兼容</a></li>
      
      <li><a href="/blog/ubuntu/ubuntu_mq/">RabbitMQ 环境搭建</a></li>
      
      <li><a href="/blog/ubuntu/ubuntu_tool/">Ubuntu 下的实用工具</a></li>
      
    </ul>
  </div>
  



  </div>
</article>

      

    
    
    
    <script src="/js/mathjax-config.js"></script>
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>

      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/8.3.1/mermaid.min.js" integrity="sha256-vOIuDSYDirTfyr+S2MjFnhOz6Rgiz4ODFAHATG0rFxw=" crossorigin="anonymous" title="mermaid"></script>
      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js" integrity="sha256-1zu+3BnLYV9LdiY85uXMzii3bdrkelyp37e0ZyTAQh0=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/r.min.js"></script>
        
      

      
      
      <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" integrity="" crossorigin="anonymous" async></script>
      
    

    
    

    
    
    <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    
    
    
    
    <script>
      const search_config = {"indexURI":"/index.json","minLength":1,"threshold":0.3};
      const i18n = {"no_results":"没有找到结果","placeholder":"搜索...","results":"搜索结果"};
      const content_type = {
        'post': "文章",
        'project': "项目",
        'publication' : "出版物",
        'talk' : "演讲"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.d6bd04fdad2ad213aa8111c5a3b72fc5.js"></script>

    






  
  
  <div class="container">
    <footer class="site-footer">
  

  <p class="powered-by">
    

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" class="back-to-top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

  </div>
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">引用</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> 复制
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> 下载
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
