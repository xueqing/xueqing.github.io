<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>支付清结算 | kiki</title>
    <link>https://xueqing.github.io/blog/o2o/%E6%94%AF%E4%BB%98%E7%B3%BB%E7%BB%9F/%E6%94%AF%E4%BB%98%E6%B8%85%E7%BB%93%E7%AE%97/</link>
      <atom:link href="https://xueqing.github.io/blog/o2o/%E6%94%AF%E4%BB%98%E7%B3%BB%E7%BB%9F/%E6%94%AF%E4%BB%98%E6%B8%85%E7%BB%93%E7%AE%97/index.xml" rel="self" type="application/rss+xml" />
    <description>支付清结算</description>
    <generator>Source Themes Academic (https://sourcethemes.com/academic/)</generator><language>zh-Hans</language>
    <image>
      <url>https://xueqing.github.io/img/icon-192.png</url>
      <title>支付清结算</title>
      <link>https://xueqing.github.io/blog/o2o/%E6%94%AF%E4%BB%98%E7%B3%BB%E7%BB%9F/%E6%94%AF%E4%BB%98%E6%B8%85%E7%BB%93%E7%AE%97/</link>
    </image>
    
    <item>
      <title>支付清结算</title>
      <link>https://xueqing.github.io/blog/o2o/%E6%94%AF%E4%BB%98%E7%B3%BB%E7%BB%9F/%E6%94%AF%E4%BB%98%E6%B8%85%E7%BB%93%E7%AE%97/readme/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      <guid>https://xueqing.github.io/blog/o2o/%E6%94%AF%E4%BB%98%E7%B3%BB%E7%BB%9F/%E6%94%AF%E4%BB%98%E6%B8%85%E7%BB%93%E7%AE%97/readme/</guid>
      <description>

&lt;h2 id=&#34;目录&#34;&gt;目录&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;1_基本概念和入门.md&#34; target=&#34;_blank&#34;&gt;基本概念和入门&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;2_渠道侧处理.md&#34; target=&#34;_blank&#34;&gt;渠道侧处理&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;3_电商侧处理.md&#34; target=&#34;_blank&#34;&gt;电商侧处理&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;4_账户和账务处理.md&#34; target=&#34;_blank&#34;&gt;账户和账务处理&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;参考&#34;&gt;参考&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://www.woshipm.com/pd/571712.html&#34; target=&#34;_blank&#34;&gt;支付清结算之基本概念和入门&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.woshipm.com/pd/576430.html&#34; target=&#34;_blank&#34;&gt;支付清结算之渠道侧处理&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.woshipm.com/pd/584132.html&#34; target=&#34;_blank&#34;&gt;支付清结算之电商侧处理&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.woshipm.com/pd/585521.html&#34; target=&#34;_blank&#34;&gt;支付清结算之账户和账务处理&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>1 基本概念和入门</title>
      <link>https://xueqing.github.io/blog/o2o/%E6%94%AF%E4%BB%98%E7%B3%BB%E7%BB%9F/%E6%94%AF%E4%BB%98%E6%B8%85%E7%BB%93%E7%AE%97/1_%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%92%8C%E5%85%A5%E9%97%A8/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      <guid>https://xueqing.github.io/blog/o2o/%E6%94%AF%E4%BB%98%E7%B3%BB%E7%BB%9F/%E6%94%AF%E4%BB%98%E6%B8%85%E7%BB%93%E7%AE%97/1_%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%92%8C%E5%85%A5%E9%97%A8/</guid>
      <description>

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;#11-%e6%94%af%e4%bb%98%e6%b5%81%e7%a8%8b&#34;&gt;1.1 支付流程&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#12-%e4%ba%a4%e6%98%93%e6%b5%81%e6%b0%b4&#34;&gt;1.2 交易流水&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#13-%e4%bc%9a%e8%ae%a1%e4%b8%bb%e4%bd%93&#34;&gt;1.3 会计主体&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#14-%e4%bc%9a%e8%ae%a1%e8%a6%81%e7%b4%a0&#34;&gt;1.4 会计要素&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#15-%e4%bc%9a%e8%ae%a1%e7%a7%91%e7%9b%ae&#34;&gt;1.5 会计科目&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#16-%e4%bc%9a%e8%ae%a1%e8%b4%a6%e6%88%b7&#34;&gt;1.6 会计账户&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#17-%e8%ae%b0%e8%b4%a6%e5%87%ad%e8%af%81&#34;&gt;1.7 记账凭证&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#18-%e4%bc%9a%e8%ae%a1%e5%88%86%e5%bd%95%e5%92%8c%e8%ae%b0%e8%b4%a6&#34;&gt;1.8 会计分录和记账&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#19-%e6%9b%b4%e5%a4%9a%e9%97%ae%e9%a2%98&#34;&gt;1.9 更多问题&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;1-1-支付流程&#34;&gt;1.1 支付流程&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;先说个比较简单的支付场景，用户(小明)用绑定的银行卡(工行)购买某电商公司(老熊公司)的产品。小明需要先在老熊公司网站上完成银行卡绑定的操作。绑卡以后，就可使用这个卡来购买商品。首先是挑选商品和下单，其后是执行支付。下单之前的流程不做介绍，从支付开始说明支付过程中的清结算问题&lt;/li&gt;
&lt;li&gt;为了简化，先从比较简单的同渠道、公司内购买的场景开始。商品也先假定为虚拟产品(如会员卡)。为了实现这个流程，有一些前置的操作需要完成：

&lt;ul&gt;
&lt;li&gt;老熊公司已对接工行的快捷支付接口。通过这个接口，可实现绑卡(签约)、支付、退款、查单等操作&lt;/li&gt;
&lt;li&gt;老熊公司已按照工行要求，在工行开了备付金账户。老熊公司通过工行接口的所有收款、退款等资金往来，都发生在这个账户&lt;/li&gt;
&lt;li&gt;小明在老熊公司的应用中绑定了自己的一张卡，为了简化处理，小明绑定的也是工行的卡，先省略跨行结算的步骤&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;用户小明在手机或 PC Web 上购买了 100 元的虚拟产品(如会员卡)。这里先从虚拟物品入手，因为实体物品情况会复杂一点，供应链和物流也是一个大课题，购买实体物品就需要考虑这个问题，而虚拟产品就可暂不考虑。然后小明在网站上执行下单、支付操作&lt;/li&gt;
&lt;li&gt;老熊公司的支付系统收到小明的支付操作请求后，系统首先会校验订单是否有问题，然后调用工行快捷支付接口，从用户的工行卡上扣除 100 元

&lt;ul&gt;
&lt;li&gt;用户的工行卡的扣款是实时进行的，也就是说，这个操作完成后，小明查看他的工行余额和流水，会有一笔 100 元的交易，并且账户余额也减少了 100 元&lt;/li&gt;
&lt;li&gt;但是这个钱并不是直接进入老熊公司的(结算)账户。工行在第二天凌晨会对前天的交易进行清算和结算。在计算收入的同时，也从中扣除掉通道费用，得到最终应该划拨到结算账户上的金额。在这个例子中假定手续费按支付金额收费，比例为 0.1%。这一笔交易，支付给工行 0.10 元，公司收入 99.9 元&lt;/li&gt;
&lt;li&gt;这里需要注意。有些银行是在扣除手续费后，将前一天的余额全部划拨到结算账户上；有些银行是先全额划拨所有收入到结算账户上，然后扣除手续费&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;1-2-交易流水&#34;&gt;1.2 交易流水&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;用户执行支付后，系统首先需要记录交易流水，流水的内容包括：

&lt;ul&gt;
&lt;li&gt;交易主体：即发起本次交易的出款的用户，一般是记录 ID、姓名等信息&lt;/li&gt;
&lt;li&gt;交易账户：即用户购买时使用的出款账户，这是用户在工行的卡，实际账户是建立在工行，但在电商系统中，为了便于结算，为这个账户建立一个代理。这个账户在系统中的 ID 是 10001(数据本身无其他含义)&lt;/li&gt;
&lt;li&gt;交易对手：即出卖虚拟产品的业务部门，一般记录部门的 ID、名称等信息&lt;/li&gt;
&lt;li&gt;结算收益：交易对手能够拿到的金额。这里是&lt;code&gt;支付金额-渠道费用&lt;/code&gt;，即 99.9 元&lt;/li&gt;
&lt;li&gt;对手账户：即虚拟产品的收款账户，为了便于结算，公司一般会对每项业务设置独立的结算账户。这个账户在系统中的 ID 是 20001(数据本身无其他含义)&lt;/li&gt;
&lt;li&gt;交易渠道：即工行的快捷支付，还需要记录渠道的 ID，名称等&lt;/li&gt;
&lt;li&gt;渠道结算账号：这也是个代理账号，记录在渠道侧的交易流水。注册在电商侧，是电商自己的账户&lt;/li&gt;
&lt;li&gt;渠道提交时间：请求渠道执行支付的时间&lt;/li&gt;
&lt;li&gt;渠道支付时间：渠道一般会在返回的报文中说明本次交易的执行时间。如果没有，则使用渠道的支付接口返回时间&lt;/li&gt;
&lt;li&gt;渠道费率：渠道的手续费，这里假定工行是按支付金额收费，比例为支付金额的 0.1%&lt;/li&gt;
&lt;li&gt;渠道费用：这里是&lt;code&gt;支付金额*手续费率&lt;/code&gt;，即 0.1 元&lt;/li&gt;
&lt;li&gt;发起交易日期：&lt;code&gt;2016年12月12日 13:00:10&lt;/code&gt;，即用户提交订单后，虚拟产品业务调用支付系统接口执行支付的时间&lt;/li&gt;
&lt;li&gt;执行交易日期：&lt;code&gt;2016年12月12日 13:00:11&lt;/code&gt;，即支付系统接口调用时间&lt;/li&gt;
&lt;li&gt;支付截止日期：必须在此日期前完成支付&lt;/li&gt;
&lt;li&gt;订单信息：在本例子中是会员卡，一般需要记录业务方订单 ID、名称、内容等信息&lt;/li&gt;
&lt;li&gt;订单金额：提交过来的原始订单的金额 100 元&lt;/li&gt;
&lt;li&gt;支付金额：用户实际支付的金额，由于没有使用优惠券、打折卡等，这里支付金额等于订单金额，是 100元&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;没有使用卡券、没有和合作方分成，这两块内容暂不记录&lt;/li&gt;
&lt;li&gt;交易流水是在完成支付时实时生成的。这个流水信息是后续记账的依据，所以务必在流水中真实记录能收集到的所有的现场信息。这里从下面几个角度来多方位全角度的描述这笔交易

&lt;ul&gt;
&lt;li&gt;交易主体，即掏钱的小明&lt;/li&gt;
&lt;li&gt;交易对手，即收钱的业务方&lt;/li&gt;
&lt;li&gt;交易渠道，即工行快捷&lt;/li&gt;
&lt;li&gt;交易商品，即会员卡&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;这里有不少冗余信息。实际上对交易涉及到所有可能会被修改的信息，如用户姓名、商品名称、商品价格，都需要在这里留一个快照，以便后续回溯和审核&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;1-3-会计主体&#34;&gt;1.3 会计主体&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;这一笔账是老熊公司的账务，不是工行的账务，也不是小明家的账务。虽然这里会有工行和小明的信息，但记账的目的是为了了解和改进老熊公司的经营状况服务&lt;/li&gt;
&lt;li&gt;老熊公司不是某个大公司的分公司或子公司，它是一家独立核算的、具有独立的资金和经营业务的单位，从会计学角度来说，他是一个独立的会计实体&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;1-4-会计要素&#34;&gt;1.4 会计要素&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;从概念上说，所有和钱有关的活动，买会员、用户充值、支付手续费等，都需要记账，这些活动，称之为会计对象&lt;/li&gt;
&lt;li&gt;每个公司都有不同的会计对象，有时候同一类活动，叫法不一样。如果直接用这些活动内容来记账，那就没法比较每个公司的情况。需要有一个记账的标准，让大家分门别类的做记录&lt;/li&gt;
&lt;li&gt;对会计对象做规范化的管理，这就引入会计要素的概念

&lt;ul&gt;
&lt;li&gt;会计要素是对会计对象进行的基本分类，是会计核算对象的具体化。如果说会计对象是个 Object，则会计要素是定义这个 Object 的 Class&lt;/li&gt;
&lt;li&gt;不同的国家对会计要素有不同的规定&lt;/li&gt;
&lt;li&gt;国际会计准则委员会(IASC)在《编制和呈报财务报表的结构》将会计要素其归类为资产、负债、权益、收益和费用五个要素&lt;/li&gt;
&lt;li&gt;美国财务会计准则委员会(FASB)在《财务会计概念公告》中将会计要素归类为资产、负债、所有者权益(净资产)、业主投资、派给业主款、综合收益、营业收入、费用、利润、损失十个要素&lt;/li&gt;
&lt;li&gt;我国《会计准则》将会计要素归类为资产、负债、所有者权益、收入、费用和利润六个要素。其中资产、负债和所有者权益，是反应公司的财务状况的。它满足如下恒等式：
&amp;gt; 资产=负债+所有者权益&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;1-5-会计科目&#34;&gt;1.5 会计科目&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;六大会计要素指明了需要记账的 scope，但毕竟粒度还是太大了。为了更详细地了解公司财务情况，引入会计科目来对会计对象进行第二层次的划分&lt;/li&gt;
&lt;li&gt;使用 IT 的语言来说，会计科目其实就是一个分类体系，用来分门别类地记账&lt;/li&gt;
&lt;li&gt;在实现上，是一个&lt;code&gt;编号+名称&lt;/code&gt;，IT 俗称字典表&lt;/li&gt;
&lt;li&gt;从定义上说，会计科目是指一个涵义明确、概念清楚、简明扼要、通俗易懂的标准名称&lt;/li&gt;
&lt;li&gt;会计科目按照经济内容的性质不同，可分为资产类科目、负债类科目、所有者权益类科目、损益类科目，成本类科目，有些金融企业还有资产负债共同类科目。在每一类会计科目下，还可继续细分，详细内容可参考2016年财政部发布的新会计准则。会计科目和要素之间的关系如下
&lt;img src=&#34;https://xueqing.github.io/blog/o2o/支付系统/ref/accountant_factor_relation.jpg&#34; alt=&#34;会计科目和要素之间的关系&#34; /&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;| 会计要素 | 所属会计科目 |
  | &amp;mdash; | &amp;mdash; |
  | 资产 | 资产 |
  | 负债 | 负债 |
  | 所有者权益 | 所有者权益 |
  | 收入 | 损益 |
  | 费用 | 损益、成本 |
  | 利润 | 损益 |
  | - | 共同 |&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;会计科目还分为总账科目和明细科目。从IT角度，可认为总账科目是一级分类，而明细科目则是这个一级分类下的二级、三级，甚至更多级别的详细的科目。记账时，会同时记录到总账、明细科目。在电商的支付系统中，一般会设置如下科目&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;| 会计科目编号 | 会计科目名称 |
  | &amp;mdash; | &amp;mdash; |
  | 1002 | 银行存款(资产类) |
  | 100201 | 业务收款 |
  | 100201001 | 支付宝收款 |
  | 100201002 | 工行收款 |
  | 100201003 | 建行收款 |
  | 1004 | 服务成本(成本类) |
  | 100401001 | 支付宝手续费 |
  | 100401002 | 工行手续费 |
  | 100401003 | 建行手续费 |
  | 6001 | 主营业务收入(损益类) |
  | 6001001 | 会员卡业务 |
  | 6001002 | 游戏业务 |&lt;/p&gt;

&lt;h2 id=&#34;1-6-会计账户&#34;&gt;1.6 会计账户&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;账户：指对会计要素的具体内容所作的科学的分类，包括两方面：账户的名称、账户的用途与结构&lt;/li&gt;
&lt;li&gt;会计科目是设置账户的依据，也是账户的名称。如对银行存款这个会计科目，也会设置一个对应的银行存款账户，用来跟踪公司在银行存款的变动&lt;/li&gt;
&lt;li&gt;在这个案例中，将设置的账户同会计科目。&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;1-7-记账凭证&#34;&gt;1.7 记账凭证&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;在以前没有电脑的时候，去买公交卡，公交公司阿姨会认真地记录你买的卡的卡号、买卡人的姓名、卡的面值等信息，运气好的时候还会给个发票。一般来说，阿姨会将购买记录登记到一个账册上，形成记账凭证，并在这里会登记发票号码&lt;/li&gt;
&lt;li&gt;在现在高科技时代，这个凭证还是少不了了。先说明细账，记录内容如下
&lt;img src=&#34;https://xueqing.github.io/blog/o2o/支付系统/ref/receiving_voucher.jpg&#34; alt=&#34;收款凭证&#34; /&gt;&lt;/li&gt;
&lt;li&gt;这里详细记录每一条交易信息，当然，通过计算机系统，可记录更多详情，包括时间、地点等&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;1-8-会计分录和记账&#34;&gt;1.8 会计分录和记账&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;大家经常看到的记录应该是这样的
&lt;img src=&#34;https://xueqing.github.io/blog/o2o/支付系统/ref/accountant_record.jpg&#34; alt=&#34;会计记录&#34; /&gt;&lt;/li&gt;
&lt;li&gt;银行存款、服务成本、主营业务收入，属于总账科目&lt;/li&gt;
&lt;li&gt;工行收款、会员卡、工行手续费，属于明细科目&lt;/li&gt;
&lt;li&gt;这里采用的是复式记账法中借贷记账法。对应的账户结构如下：
&lt;img src=&#34;https://xueqing.github.io/blog/o2o/支付系统/ref/accountant_struct.jpg&#34; alt=&#34;账户结构&#34; /&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;借贷复式记账法的特点是&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;采用借、贷作为记账符号，建立在会计恒等式基础上，遵循&lt;strong&gt;有借必有贷，借贷必相等&lt;/strong&gt;的原则&lt;/li&gt;
&lt;li&gt;账户基本结构是： 左侧为借，右侧为贷&lt;/li&gt;
&lt;li&gt;一般采用如上图所示的 T 行账户的形式来描述&lt;/li&gt;
&lt;li&gt;借贷所代表的增加、减少的含义并不固定，和账户的性质有关&lt;/li&gt;
&lt;/ul&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;借方&lt;/th&gt;
&lt;th&gt;贷方&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;资产增加&lt;/td&gt;
&lt;td&gt;资产减少&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;权益减少&lt;/td&gt;
&lt;td&gt;权益增加&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;成本增加&lt;/td&gt;
&lt;td&gt;成本减少&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;收入减少&lt;/td&gt;
&lt;td&gt;收入增加&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;费用及支出增加&lt;/td&gt;
&lt;td&gt;费用及支出减少&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;1-9-更多问题&#34;&gt;1.9 更多问题&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;作为清结算的入门介绍，这里介绍的是最简单的场景，以此来解释清结算相关的概念，特别是会计学一些从IT角度不容易理解的名词。实际上，这个场景还有很多问题：

&lt;ul&gt;
&lt;li&gt;严格的说，会员卡的收入，还不能立即作为公司主营业务收入。会员卡是预付款项，用户开始使用会员卡，公司需要为这个使用提供服务；用户结束使用会员卡之后，这一笔开支才算是真正落入公司主营业务收入中&lt;/li&gt;
&lt;li&gt;会员卡在使用期间，公司针对会员业务的各种开销，要分摊到这一段期间的会员上。将开销分摊到每张会员卡上，计算其使用成本，最终才能够计算出收益&lt;/li&gt;
&lt;li&gt;用户会员卡购买的款项是立即反映到备付金账户的，但并不是立即到结算账户的，一般是 T+1 结算，也就是第二天银行才会将清算好的资金打到公司结算账户上，这种情况应该如何记账？&lt;/li&gt;
&lt;li&gt;如果支付过程中使用了代金券和优惠券，那又应该如何考虑？&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;此外，还有退款、充值等场景的清结算，这些问题都将在本系列的文章中详细介绍。本文仅介绍一些相关的概念&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>2 渠道侧处理</title>
      <link>https://xueqing.github.io/blog/o2o/%E6%94%AF%E4%BB%98%E7%B3%BB%E7%BB%9F/%E6%94%AF%E4%BB%98%E6%B8%85%E7%BB%93%E7%AE%97/2_%E6%B8%A0%E9%81%93%E4%BE%A7%E5%A4%84%E7%90%86/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      <guid>https://xueqing.github.io/blog/o2o/%E6%94%AF%E4%BB%98%E7%B3%BB%E7%BB%9F/%E6%94%AF%E4%BB%98%E6%B8%85%E7%BB%93%E7%AE%97/2_%E6%B8%A0%E9%81%93%E4%BE%A7%E5%A4%84%E7%90%86/</guid>
      <description>

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;#21-%e6%94%af%e4%bb%98&#34;&gt;2.1 支付&lt;/a&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;#211-%e9%93%b6%e8%a1%8c%e7%9b%b4%e8%bf%9e&#34;&gt;2.1.1 银行直连&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#212-%e7%ac%ac%e4%b8%89%e6%96%b9%e6%94%af%e4%bb%98%e5%b9%b3%e5%8f%b0&#34;&gt;2.1.2 第三方支付平台&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#2121-%e5%a4%87%e4%bb%98%e9%87%91&#34;&gt;2.1.2.1 备付金&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#22-%e5%85%85%e5%80%bc&#34;&gt;2.2 充值&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#23-%e6%8f%90%e7%8e%b0&#34;&gt;2.3 提现&lt;/a&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;#231-%e9%93%b6%e4%bc%81%e7%9b%b4%e8%bf%9e&#34;&gt;2.3.1 银企直连&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#232-%e4%bc%81%e4%b8%9a%e7%bd%91%e9%93%b6&#34;&gt;2.3.2 企业网银&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#233-%e7%ac%ac%e4%b8%89%e6%96%b9%e6%94%af%e4%bb%98%e6%b8%a0%e9%81%93&#34;&gt;2.3.3 第三方支付渠道&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;2-1-支付&#34;&gt;2.1 支付&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;这里的渠道侧，包括银行、第三方支付以及银联&lt;/li&gt;

&lt;li&gt;&lt;p&gt;举例：小明通过工行在老熊公司买了一张 100 元的会员卡，工行按照支付金额的 0.1% 收取手续费，产生了如下会计分录&lt;/p&gt;

&lt;p&gt;借：银行存款-工行收款 100
  贷：主营业务收入-会员卡 100
  借：服务成本-工行手续费 0.1
  贷：银行存款-工行收款 0.1&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;这里详细介绍在支付时的清结算过程，分别从银行直连、第三方支付的角度来说明。&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;2-1-1-银行直连&#34;&gt;2.1.1 银行直连&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;用户通过工行支付的款项，在银行侧并不是直接落地到老熊公司的结算账户上，而是先到一个中间账户上。这就需要了解银行侧的账户和资金处理流程。针对第三方支付和电商直连银行，在银行侧的账户和资金处理流程是不一样的&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;电商公司直连银行，不需要复杂的备付金管理&lt;/li&gt;
&lt;li&gt;当电商公司(第三方支付公司类似)和工行签约开通支付接口后，工行会为这个接口开设一个结算账户。通过这个接口流转的资金最终会结算到这个账户上。这也是电商公司可以提现的一个账户&lt;/li&gt;
&lt;li&gt;另外，为了方便资金清算，工行还会为电商公司开设一个收付账户，这个账户是直接对接线上资金处理的，这是工行内部账户，电商公司无法操作这个账户，但是可以看到这个账户的收付情况&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;支付时，资金在工行侧的流转流程&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;用户提交支付请求，支付系统调用工行快捷支付接口执行支付&lt;/li&gt;
&lt;li&gt;工行服务器检查用户账户余额和状态，如果余额不足或者状态异常，则停止支付。继续检查电商公司的收款账户的状态。如果状态正常，开始执行支付。资金从用户账户转到收付账户上&lt;/li&gt;
&lt;li&gt;工行采用 T+1 的结算，将 T 日用户支付的所有款项，扣除退款，扣除手续费等费用后，将剩余资金打入电商结算账户上&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;在商户侧，需要调整前期所述的记账流程。用户付费不能直接进入公司存款账户，而是记在应收账款下。需等待银行完成清结算后，才能将商家在该银行所有的收款转到存款中&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;用户付费时，会计分录&lt;/p&gt;

&lt;p&gt;借：应收账款-工行收款 99.9
服务成本-工行手续费 0.1
贷：主营业务收入-会员卡 100&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;在电商侧执行日切，将当前的应收账款归集到存款上，在接收到工行对账单后，对这个日切结果也要对账。假定当前收入为 200 万元，手续费为 2 千元，对应的会计分录为&lt;/p&gt;

&lt;p&gt;借：银行存款-工行 1,998,000
  贷：应收账款-工行收款 1,998,000&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;通过这个会计分录，怎么知道这一笔手续费是谁付的？要知道这只是从会计角度做的记录，在具体存储库的设计时，还需要添加更多的信息，包括交易发生的时间、会员卡号等信息&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;对工行来说，这些资金都是行内流转，不涉及到跨行转账的问题。因此在银行内部的处理也比较简单，一般就是一个内部的信息流，分别将商家账户和用户账户的资金做了增减，并无实际的资金流转&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;2-1-2-第三方支付平台&#34;&gt;2.1.2 第三方支付平台&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;对于没有直连的银行，可以通过第三方支付来收款。第三方支付侧的资金处理和银行的类似&lt;/li&gt;

&lt;li&gt;&lt;p&gt;以支付宝为例，当商家在支付宝开通支付接口后，支付宝为商家建立账户以及商户号。每个业务对应一个商户号。用户提交支付后，支付宝完成收款后，直接进行分润，扣除手续费，将剩余资金转移到商户号上&lt;/p&gt;

&lt;p&gt;借：应收账款-支付宝会员账户收款 99.9
  服务成本-支付宝会员手续费 0.1
  贷：主营业务收入-会员卡 100&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;这里记为应收账款，因为 T+1 后，支付宝还要将资金按照商户的要求，转移到指定银行账户上。假定这个银行账户为建行的账户，当天的收入为 200 万元，手续费为 2 千元，对应的会计分录为&lt;/p&gt;

&lt;p&gt;借：银行存款-建行 1,998,000
  贷：应收账款-支付宝会员账户收款 1,998,000&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;那对于这一笔收款，支付宝是如何处理？这就涉及到备付金的问题了&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&#34;2-1-2-1-备付金&#34;&gt;2.1.2.1 备付金&lt;/h4&gt;

&lt;ul&gt;
&lt;li&gt;关于备付金，建议大家详细阅读《支付机构客户备付金存管办法》全文，对备付金的使用和管理有详细的介绍

&lt;ul&gt;
&lt;li&gt;当用户在电商网站(如淘宝网)购买商品，下单后，资金并不是立即进入商家的账户上，而是暂存在第三方支付公司&lt;/li&gt;
&lt;li&gt;当用户确认接收到商品后，资金从第三方支付公司转到商家账户上&lt;/li&gt;
&lt;li&gt;这个资金被称为备付金，“指支付机构为办理客户委托的支付业务而实际收到的预收待付货币资金”&lt;/li&gt;
&lt;li&gt;备付金由银行托管，备付金银行分为存管银行和合作银行&lt;/li&gt;
&lt;li&gt;存管银行只能有一家，负责处理备付金跨行收付，并对支付机构存放在各银行的备付金信息做归集、合并与监督&lt;/li&gt;
&lt;li&gt;合作银行可以有多家，可以办理针对本银行的备付金存取和监管&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;和备付金相关的账户有三类：

&lt;ul&gt;
&lt;li&gt;存管账户：可以以现金形式接收客户备付金、以银行转账方式办理客户备付金收取和支取业务的专用存款账户。针对备付金存管银行，可以一个省开设一个存管账户。只有存管账户才能够支持跨行付款&lt;/li&gt;
&lt;li&gt;收付账户：可以以现金形式或以银行转账方式接收客户备付金、以银行资金内部划转方式办理客户备付金支取业务的专用存款账户。在同一个备付金合作银行只能开设一个收付账户&lt;/li&gt;
&lt;li&gt;汇缴账户：仅支持同行收款以及退款时原路退回。在备付金存管和合作银行都可以开设。备付金银行应当于每日营业终了前，将备付金汇缴账户内的资金全额划转至支付机构的备付金存管账户或在同一备付金合作银行开立备付金收付账户&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;有了收付账户，还有必要开设汇缴账户吗？这要看交易规模了，如果规模大，那是有必要的，因为有些地方银行可以给非常低的手续费用，可以省一大笔钱&lt;/li&gt;
&lt;li&gt;这几个账户都是备付金专用的活期存款账户。汇缴账户到收付账户的划拨，是通过银行自己行内转账进行；收付账户到存管账户，就走人行的大小额、超级网银或者同城系统进行划拨。当然，这些接口一般第三方支付是不能直接访问的，但可以通过银行提供的接口来进行&lt;/li&gt;
&lt;li&gt;这样在第三方支付公司，用户支付的资金首先进入汇缴账户或者收付账户，日终后，汇缴账户的资金全部汇总到收付账户上&lt;/li&gt;
&lt;li&gt;在上述小明的例子中，如果小明使用的卡是招行的卡，在有备付金支持的情况下，小明支付的100元是通过招行的内部转账直接进入了支付宝在招行的备付金收付账户或者汇缴账户。这样将跨行转账变成行内资金划拨，可以减少通道费的支出，也使得资金到账更为迅捷。第三方支付备付金的使用和调拨是个专门的话题。这里不再详细展开&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;2-2-充值&#34;&gt;2.2 充值&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;资金沉淀成为电商公司孜孜以求的目标。用户充值既有利于提升支付体验，特别是对高频小额支付而言；由此也可以形成可观的资金沉淀，这对电商公司来说是个一举多得的好事。但此举是迈向违规的危险第一步&lt;/li&gt;
&lt;li&gt;接之前的场景，老熊公司在工行开设了一个对公账户，用于收款，这个账户可以用结算账户。先考虑用户小明使用工行卡充值的场景。公司需要为每个用户开设一个账户，用来跟踪账户余额。这个账户有两种处理方式，所谓的虚户和实户

&lt;ul&gt;
&lt;li&gt;虚户：指客户和商户的资金都存放在电商公司开设的对公账户上，老熊公司内部为每个实体维护一个虚拟账户。当客户给商家支付时，资金直接在虚拟账户上划拨，没有实际的资金流转，只有信息流。由于虚户是开设在电商平台上，所以也叫支付账户。大部分电商公司用的都是这种模式&lt;/li&gt;
&lt;li&gt;实户：指在银行侧为每个客户和商户在对公账户下开设二级账户。每个账户都是相互独立的。对于少数服务大客户的电商公司来说，使用这种模式也比较方便。相对支付账户，这被称为银行账户&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;这里介绍虚户的情况。使用虚户时，电商需要为客户和商户建立内部账户。这个内部账户，对电商公司来说，需要记录在负债上&lt;/li&gt;

&lt;li&gt;&lt;p&gt;回到充值的案例：用户使用工行的卡，给自己的账户充值 100 块钱，不考虑手续费【手续费处理方法支付】，会计分录：&lt;/p&gt;

&lt;p&gt;借：应收账款-工行收款 100
贷：客户 A 账户 100&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;资金先进入应收账款，因为充值和支付一样，资金也是在清结算完成后才到账的。用户在其他行充值情况应该如何处理？如果电商公司和这个银行有开通支付通道，那就会有对应的对公结算账户，充值款项就会在结算完成后，进入这个账户。如果电商和这个银行没有对接，需要通过其他第三方渠道，如支付宝、微信支付等来完成充值，对应的，资金也会进入第三方渠道。这和支付情况也是类似的。不管用户用哪个卡充值，最终的钱都记录在客户 A 的虚拟账户上&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;第三方支付在处理充值时流程和上述是类似的。但是当电商调用第三方支付接口来完成充值时，和银行不一样地方在于，这个充值是实时入账的。虽然银行并不是实时把充值的金额结算到第三方支付的银行账户上的，而是到T+1 完成结算后才会到账。但对第三方支付而言，在银行接口确认成功后，就可以假定 T+1 银行肯定可以把钱结算给自己。因此可以实时把电商在第三方支付的账户的金额增加，也即实时到账&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;2-3-提现&#34;&gt;2.3 提现&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;有充值，一般都需要提现。可提现是一个危险的业务，提供资金逃离电商的途径&lt;/li&gt;
&lt;li&gt;对充值和支付来说，就算出问题了，钱还在。而提现就麻烦了，一旦出问题，钱都没了。对提现的账户和账务处理尤其谨慎&lt;/li&gt;
&lt;li&gt;电商提现的主要途径是银企直联、企业网银和第三方支付代付&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;2-3-1-银企直连&#34;&gt;2.3.1 银企直连&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;对于商户和客户规模不大的公司，通过将公司内部的 ERP、财务系统等业务系统和银行接口对接，实现银企直连，可以让财务人员直接通过内部业务系统来打款&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;2-3-2-企业网银&#34;&gt;2.3.2 企业网银&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;一般银行都提供的企业网银接口，支持同行批量打款(代付)功能。银行将企业对公账户扣款，打到对应的个人账户上。对于个人跨行取现，本质上来说，是将对公账户的资金转账到对私账户上&lt;/li&gt;
&lt;li&gt;目前银行侧转账需要通过人行的大小额系统和超级网银来进行。人行系统并不直接对企业开放，银行通过企业网银来封装这些接口，批发或者零售给企业使用

&lt;ul&gt;
&lt;li&gt;行内清算系统：银行内部转账一般通过此系统来进行，不限金额，实时到账，手续费低。对于同行提现，如上述案例，小明需要将零钱提现到工行账户上，老熊公司在工行也开设了用于收付的对公账户，则可以通过工行的行内清算系统，直接 100 元支付给小明&lt;/li&gt;
&lt;li&gt;小额支付系统：大小额支付系统同属于央行的中国现代化支付系统(CNAPS)。5 万以内的普通贷记业务可以通过央行的小额批量支付系统(BEPS)来进行，这是 7*24 小时运行，批量运行，收集到若干交易后统一打包处理，所以是非实时到账的，费用相对大额来说也比较低。此外，小额支付需要提供联行号，即支行信息，一般绑卡流程不会要求用户提供此类信息&lt;/li&gt;
&lt;li&gt;大额支付系统：大额实时支付系统(HVPS)每笔交易都实时发送，实时清算的，所以基本上能实时到账，跨行资金零在途。但大额系统运行的时间，仅限于工作日的 8:30~17:00 运行，节假日也不运行。目前对使用大额支付系统进行转账并没有设置最低资金量的要求，也就是一块钱也会给你转过去。但是费用较高，另外大额支付系统也需要支行信息(联行号)&lt;/li&gt;
&lt;li&gt;超级网银：全称是网上支付跨行清算系统，2013 年 10 月份正式投产运行。超级网银是对大小额支付系统的一个补充，接入机构不再限于银行，第三方支付也可以接入，所以有的第三方支付给商户提供的提现代发功能就是基于超级网银做的。7*24 小时实时到账，单笔上限 5 万元。超级网银并不是所有的银行都支持，目前至少支持172 家主要银行。此外，超级网银交易可以不需要联行号&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;对电商来说，由于不能直接访问央行的这些接口，对接银行，通过银行来访问央行的接口，是主要的提现方式。但不同的银行，针对不同的提现场景，收费不一样。所以在具体实现提现的时候，还需要有提现路由(打款路由)，从费率、支持的额度、到账时间等多个维度来评估和选择提现渠道&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;2-3-3-第三方支付渠道&#34;&gt;2.3.3 第三方支付渠道&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;支付宝、微信等第三方支付公司一般也都提供代付服务，可以是通过文件来实现批量代付，也可以通过接口来实现提现

&lt;ul&gt;
&lt;li&gt;第三方支付与用户提现的银行有合作关系且银行提供实时到账接口，此类银行支持实时到账的提现操作；如果只提供准实时到账接口(例如 2 小时到账)，则此类合作银行只支持准实时到账提现操作(支付宝为 2 小时到账)&lt;/li&gt;
&lt;li&gt;第三方支付与用户提现的银行无合作关系，只能通过银行小额支付系统定时跑批，此类只支持 2 天内到账。&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;不管通过哪个途径来实现，提现的会计分录和充值相反，借记用户的虚拟账户，贷记对公账户存款&lt;/p&gt;

&lt;p&gt;借：客户 A 账户 100
  贷：银行存款-工行 100&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>3 电商侧处理</title>
      <link>https://xueqing.github.io/blog/o2o/%E6%94%AF%E4%BB%98%E7%B3%BB%E7%BB%9F/%E6%94%AF%E4%BB%98%E6%B8%85%E7%BB%93%E7%AE%97/3_%E7%94%B5%E5%95%86%E4%BE%A7%E5%A4%84%E7%90%86/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      <guid>https://xueqing.github.io/blog/o2o/%E6%94%AF%E4%BB%98%E7%B3%BB%E7%BB%9F/%E6%94%AF%E4%BB%98%E6%B8%85%E7%BB%93%E7%AE%97/3_%E7%94%B5%E5%95%86%E4%BE%A7%E5%A4%84%E7%90%86/</guid>
      <description>

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;#31-%e6%94%af%e4%bb%98&#34;&gt;3.1 支付&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#32-%e5%a4%96%e9%83%a8%e7%bb%93%e7%ae%97&#34;&gt;3.2 外部结算&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#33-%e4%bf%83%e9%94%80&#34;&gt;3.3 促销&lt;/a&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;#331-%e4%bb%a3%e9%87%91%e5%88%b8&#34;&gt;3.3.1 代金券&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#332-%e6%89%93%e6%8a%98%e9%94%80%e5%94%ae&#34;&gt;3.3.2 打折销售&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#333-%e4%b9%b0%e8%b5%a0&#34;&gt;3.3.3 买赠&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#334-%e6%bb%a1%e5%87%8f&#34;&gt;3.3.4 满减&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#335-%e5%ae%9e%e7%89%a9%e8%b4%ad%e4%b9%b0%e4%bb%a5%e5%8f%8a%e7%a8%8e%e5%8a%a1%e9%97%ae%e9%a2%98&#34;&gt;3.3.5 实物购买以及税务问题&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#336-%e9%80%80%e6%8d%a2%e8%b4%a7&#34;&gt;3.3.6 退换货&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#34-%e5%85%85%e5%80%bc%e4%b8%8e%e6%8f%90%e7%8e%b0&#34;&gt;3.4 充值与提现&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;本文描绘一堆业务对应的会计分录&lt;/p&gt;

&lt;h2 id=&#34;3-1-支付&#34;&gt;3.1 支付&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;继续小明的案例，小明通过工行在老熊公司买了一张 100 元的会员卡，工行按照支付金额的 0.1% 收取手续费，产生了如下会计分录&lt;/p&gt;

&lt;p&gt;借：应收账款-工行收款 100-100*0.1% = 99.9
  服务成本-工行手续费 100*0.1% = 0.1
  贷：主营业务收入-会员卡 100&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;在电商侧执行日切，将当前的应收账款归集到存款上，在接收到工行对账单后，对这个日切结果也要对账。假定当前收入为 200 万元，手续费为 2 千元，对应的会计分录为&lt;/p&gt;

&lt;p&gt;借：银行存款-工行 2,000,000-2,000= 1,998,000
  贷：应收账款-工行收款 1,998,000&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;3-2-外部结算&#34;&gt;3.2 外部结算&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;如果小明买的是其他公司(凤凰公司)的会员卡，该卡由老熊公司代理销售，代理价格是 90 元。这个流程会更复杂。买断式的代理，和仅仅支付手续费的代理在记账上略有区别。这里仅提供供参考的版本，具体记账的会计科目需要按照公司的情况来具体处理&lt;/li&gt;

&lt;li&gt;&lt;p&gt;老熊公司接收到凤凰公司发送过来的 100 张会员卡，每张卡售价是 100 元。这些卡作为预售的代销商品入库，记录到代销商品中。其会计分录如下&lt;/p&gt;

&lt;p&gt;借：代销商品-凤凰会员卡 90*100 = 9,000
  贷：代销商品款-凤凰会员卡 90*100 = 9,000&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;对应的会员卡信息，每张卡的卡号、价格等信息，可以记录到明细表中&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;老熊公司销售出一张会员卡给小明，产生的会计分录如下&lt;/p&gt;

&lt;p&gt;借：应收账款-工行收款 99.9
  服务成本-工行手续费 0.1
  贷：主营业务收入-会员卡 100&lt;/p&gt;

&lt;p&gt;借：主营业务成本-会员卡 90
  贷：代销商品-凤凰会员卡 90&lt;/p&gt;

&lt;p&gt;借：代销商品款-凤凰会员卡 90
  贷：应付账款-凤凰会员卡 90&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;这里是将收入记录到主营业务收入的科目下，实际情况应该按照公司的会计要求来进行&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;老熊公司当天销售了 10 张卡，银行将当天的收入结算给老熊公司。这个可以单独分录，也可以和银行的其他结算一起分录&lt;/p&gt;

&lt;p&gt;借：银行存款-工行 9,990
  贷：应收账款-工行收款 9,990&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;老熊公司当天将卡收入结算给凤凰公司，未考虑税费的问题，会计分录如下&lt;/p&gt;

&lt;p&gt;借：应付账款-凤凰会员卡 9,000
  贷：银行存款 9,000&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;3-3-促销&#34;&gt;3.3 促销&lt;/h2&gt;

&lt;p&gt;常用促销方式包括代金券、折扣券、买赠、满减等，以下简单介绍各个方式的记账&lt;/p&gt;

&lt;h3 id=&#34;3-3-1-代金券&#34;&gt;3.3.1 代金券&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;对代金券的财务处理目前没有统一的标准，会计处理方法因公司核算方式不同会有多种，有营销费用、销售折扣、主营业务成本等方式&lt;/li&gt;

&lt;li&gt;&lt;p&gt;在这个案例中，我们假定老熊公司发放了 100 张优惠券，每张价值 10 元。会计分录&lt;/p&gt;

&lt;p&gt;借：营销成本-通用优惠券 1000
  贷：预计负债-通用优惠券 1000&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;当用户使用优惠券购买商品时，10 元的优惠券，用户实际付款是 90 元，手续费按照 90*0.1% 来计算。会计分录&lt;/p&gt;

&lt;p&gt;借：应收账款-工行收款 89.91
  服务成本-工行手续费 0.09
  预计负债-通用优惠券 10
  贷：主营业务收入-会员卡 100&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;这批优惠券到期后，实际发放了 80 张，还有 20 张需要回收，每张价值还是 10 元，回收时会计分录&lt;/p&gt;

&lt;p&gt;借：预计负债-通用优惠券 200
  贷：营销成本.通用优惠券 200&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;这种方式处理优惠券，是按照使用优惠券之前的价格，也就是 100 元来计算增值税，公司所得税会相应扣减，但处理起来也比较麻烦。还有一种简单的方式是直接在用户消费的时候记账&lt;/p&gt;

&lt;p&gt;借：应收账款-工行收款 89.91
  服务成本-工行手续费 0.09
  贷：主营业务收入-会员卡 90&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;可以在明细账中记录用户使用的优惠券&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;3-3-2-打折销售&#34;&gt;3.3.2 打折销售&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;折扣销售时，和普通销售一样处理，金额按照打折后的来计算&lt;/li&gt;

&lt;li&gt;&lt;p&gt;老熊公司促销，8 折优惠，小明用 80 块钱买了张会员卡，会计分录如下&lt;/p&gt;

&lt;p&gt;借：应收账款-工行收款 80-0.08 = 79.92
  服务成本-工行手续费 80*0.1% = 0.08
  贷：主营业务收入-会员卡 80&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;3-3-3-买赠&#34;&gt;3.3.3 买赠&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;买赠和打折销售类似，需要按照比例来分摊&lt;/li&gt;

&lt;li&gt;&lt;p&gt;老熊公司推出买一增一活动，买一张 100 元的会员卡，赠送一张价值 50 元的点播卡。会计分录如下&lt;/p&gt;

&lt;p&gt;借：应收账款-工行收款 100-0.1 = 99.9
  服务成本-工行手续费 100*0.1% = 0.1
  贷：主营业务收入-会员卡 100*100/(100+50) = 66.67
  主营业务收入-点播卡 50*100/(100+50) = 33.33&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;3-3-4-满减&#34;&gt;3.3.4 满减&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;满减活动的处理和买赠类似，需要按比例来分摊&lt;/li&gt;

&lt;li&gt;&lt;p&gt;老熊公司推出满 200 减 50 的活动，小明买了一张 100 元会员卡，1 张 50 元点播卡，1 张 50 元游戏卡。也就是 150 元买了 3 张卡，每张卡的收入按比例来分摊，会计分录如下&lt;/p&gt;

&lt;p&gt;借：应收账款-工行收款 200-0.2 = 199.8
  服务成本-工行手续费 200&lt;em&gt;0.1% = 0.2
  贷：主营业务收入-会员卡 100&lt;/em&gt;(200-50)/200 = 75
  主营业务收入-点播卡 50&lt;em&gt;(200-50)/200 = 37.5
  主营业务收入-游戏卡 50&lt;/em&gt;(200-50)/200 = 37.5&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;3-3-5-实物购买以及税务问题&#34;&gt;3.3.5 实物购买以及税务问题&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;实物购买涉及到送货费用、税费等。送货费用每个公司处理起来差异较大，这里不介绍&lt;/li&gt;
&lt;li&gt;在税费处理上，一般是在计算业务收入时扣除。实物按照 17% 的增值税来扣减&lt;/li&gt;

&lt;li&gt;&lt;p&gt;如小明在老熊公司买了 100 块钱的卡通熊玩偶，记账如下：&lt;/p&gt;

&lt;p&gt;借：应收账款-工行收款 99.9
  服务成本-工行手续费 0.1
  贷：主营业务收入-卡通熊 &lt;sup&gt;100&lt;/sup&gt;&amp;frasl;&lt;sub&gt;1&lt;/sub&gt;.17 = 85.47元
  应交税费–应交增值税 &lt;sup&gt;100&lt;/sup&gt;&amp;frasl;&lt;sub&gt;1&lt;/sub&gt;.17*17%=14.53元&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;3-3-6-退换货&#34;&gt;3.3.6 退换货&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;退货根据销售的不同阶段，采取相应的冲销。在货款到对公账户前退货，则对冲应收账款；如果是货款已经到公司银行账户了，则对冲银行存款&lt;/li&gt;
&lt;li&gt;换货可以按先退货再购买的方式来记账&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;3-4-充值与提现&#34;&gt;3.4 充值与提现&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;和支付类似，用户充值也分为两个步骤&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;第一步是执行充值操作，充值到公司对公账户上，但是资金并不是立即到账的，这个过程的会计分录如下&lt;/p&gt;

&lt;p&gt;借：应收账款-工行收款 99.9
服务成本-工行手续费 0.1
贷：客户账户-小明 100&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;在第二天资金到账后，应收账款变为公司的存款，这个过程同支付&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;提现流程和充值相反，会计分录如下&lt;/p&gt;

&lt;p&gt;借：客户账户-小明 100
  服务成本-工行手续费 0.1
  贷：应付账款-工行 100.1&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>4 账户和账务处理</title>
      <link>https://xueqing.github.io/blog/o2o/%E6%94%AF%E4%BB%98%E7%B3%BB%E7%BB%9F/%E6%94%AF%E4%BB%98%E6%B8%85%E7%BB%93%E7%AE%97/4_%E8%B4%A6%E6%88%B7%E5%92%8C%E8%B4%A6%E5%8A%A1%E5%A4%84%E7%90%86/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      <guid>https://xueqing.github.io/blog/o2o/%E6%94%AF%E4%BB%98%E7%B3%BB%E7%BB%9F/%E6%94%AF%E4%BB%98%E6%B8%85%E7%BB%93%E7%AE%97/4_%E8%B4%A6%E6%88%B7%E5%92%8C%E8%B4%A6%E5%8A%A1%E5%A4%84%E7%90%86/</guid>
      <description>

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;#41-%e8%b4%a6%e6%88%b7%e4%bd%93%e7%b3%bb&#34;&gt;4.1 账户体系&lt;/a&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;#411-%e8%b5%84%e4%ba%a7%e7%b1%bb%e8%b4%a6%e6%88%b7&#34;&gt;4.1.1 资产类账户&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#412-%e8%b4%9f%e5%80%ba%e7%b1%bb%e8%b4%a6%e6%88%b7&#34;&gt;4.1.2 负债类账户&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#413-%e6%89%80%e6%9c%89%e8%80%85%e6%9d%83%e7%9b%8a%e7%b1%bb%e8%b4%a6%e6%88%b7&#34;&gt;4.1.3 所有者权益类账户&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#414-%e6%8d%9f%e7%9b%8a%e7%b1%bb%e8%b4%a6%e6%88%b7&#34;&gt;4.1.4 损益类账户&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#415-%e6%88%90%e6%9c%ac%e7%b1%bb%e8%b4%a6%e6%88%b7&#34;&gt;4.1.5 成本类账户&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#416-%e5%85%b1%e5%90%8c%e7%b1%bb%e8%b4%a6%e6%88%b7&#34;&gt;4.1.6 共同类账户&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#417-%e8%b4%a6%e6%88%b7%e4%bd%93%e7%b3%bb&#34;&gt;4.1.7 账户体系&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#42-%e8%b4%a6%e6%88%b7%e7%bb%93%e6%9e%84&#34;&gt;4.2 账户结构&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#43-%e6%94%af%e4%bb%98%e6%b5%81%e7%a8%8b&#34;&gt;4.3 支付流程&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#44-%e6%94%af%e4%bb%98%e8%ae%a2%e5%8d%95&#34;&gt;4.4 支付订单&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#45-%e6%94%af%e4%bb%98%e8%ae%b0%e5%bd%95&#34;&gt;4.5 支付记录&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#46-%e6%94%af%e4%bb%98%e8%ae%b0%e8%b4%a6&#34;&gt;4.6 支付记账&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#47-%e4%bc%9a%e8%ae%a1%e8%ae%b0%e8%b4%a6&#34;&gt;4.7 会计记账&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#48-%e5%af%b9%e8%b4%a6&#34;&gt;4.8 对账&lt;/a&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;#481-%e5%86%85%e9%83%a8%e5%af%b9%e8%b4%a6&#34;&gt;4.8.1 内部对账&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#482-%e6%b8%a0%e9%81%93%e5%af%b9%e8%b4%a6&#34;&gt;4.8.2 渠道对账&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#483-%e8%b4%a6%e8%b4%a6%e6%a0%b8%e5%af%b9&#34;&gt;4.8.3 账账核对&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#484-%e8%b4%a6%e5%ae%9e%e6%a0%b8%e5%af%b9&#34;&gt;4.8.4 账实核对&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#49-%e7%bb%93%e6%9d%9f%e8%af%ad&#34;&gt;4.9 结束语&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;4-1-账户体系&#34;&gt;4.1 账户体系&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;在设计清结算系统前，首先需要完成账户体系的梳理&lt;/li&gt;
&lt;li&gt;账户是用来记录会计科目所反映的业务内容的工具，它根据会计科目开设&lt;/li&gt;
&lt;li&gt;账户有多种维度的分类

&lt;ul&gt;
&lt;li&gt;按照经济内容来说，账户分为资产类账户、负债类账户、所有者权益类账户、损益类账户、成本类账户和共同类账户&lt;/li&gt;
&lt;li&gt;按照会计周期内期末是否有余额，也分为实账户和虚账户&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;4-1-1-资产类账户&#34;&gt;4.1.1 资产类账户&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;资产类账户：用来反映资产增加、减少以及增减变动结果的账户&lt;/li&gt;
&lt;li&gt;和支付系统相关的主要资产类账户有：银行存款、应收账款、预付账款、库存商品、发出商品等&lt;/li&gt;
&lt;li&gt;资产增加登记在借方，减少登记在贷方，期末有余额的话，一般出现在借方&lt;/li&gt;

&lt;li&gt;&lt;p&gt;在一个会计期间，所有借方金额的累加为“借方本期发生额”，所有贷方金额的累加为“贷方本期发生额”&lt;/p&gt;

&lt;p&gt;资产账户的余额=借方期初余额+借方本期发生额-贷方本期发生额。&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;为了跟踪在每个银行的存款变更情况，需要对公司在各个银行开通的收款账户设置对应的银行存款账户、应收账款账户。在小明购买会员卡的案例中，资产类账户包括&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;银行存款：这是一个总账账户，记录电商公司在各个银行的总存款&lt;/li&gt;
&lt;li&gt;应收账款：这是一个总账账户，记录在银行的应收账款，这是虚账户，期末无余额&lt;/li&gt;
&lt;li&gt;银行存款-工行：这是一个明细账户，对应在工行的对公账户的存款变化&lt;/li&gt;
&lt;li&gt;应收账款-工行：这是一个明细账户，记录在工行的收款情况，这是虚账户，期末无余额&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;4-1-2-负债类账户&#34;&gt;4.1.2 负债类账户&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;负债类账户：实账户，记账规则跟资产类相反，负债增加记为贷，负债减少记为借，期末如有余额，一般在贷方，表明期末有债务实有额，负债类账户的余额计算&lt;/p&gt;

&lt;p&gt;贷方期末余额=贷方期初余额+贷方本期发生额-借方本期发生额。&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;从支付系统的角度，电商公司的自有账户，包括针对个人的账户和针对商户的账户，一般放在负债类账户下&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;此外，应付账款、预收账款、应交税费等，也是负债类账户&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;4-1-3-所有者权益类账户&#34;&gt;4.1.3 所有者权益类账户&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;所有者权益类账户：用来反映所有者权益增加、减少和变动结果的账户&lt;/li&gt;
&lt;li&gt;记账规则跟负债类账户一致：所有者权益增加记为贷，减少记为借&lt;/li&gt;
&lt;li&gt;和支付系统有关的所权账户包括：本年利润、利润分配等账户&lt;/li&gt;
&lt;li&gt;企业取得的收入最终会使得所有者权益增加，因此收入类账户的记账方法跟所有者权益一致：增加记为贷，减少或者转销记为借，通常该账户期末无余额(因为期末收入都会转为所有者权益，如未分配利润等)，属于虚账户&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;4-1-4-损益类账户&#34;&gt;4.1.4 损益类账户&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;损益类账户分为收入类和费用类账户

&lt;ul&gt;
&lt;li&gt;收入类账户：指各种收入、补贴、投资收益，如主营业务收入、其他业务收入和营业外收入等，增加记为贷，减少记为借&lt;/li&gt;
&lt;li&gt;费用类账户包括：主营业务成本、其他业务成本、营销费用等。企业在日常经营活动中会发生各种各样的耗费，这些耗费在会计学上称为成本费用，它们是收入的抵减项目，在抵销收入之前，可以视为一种资产，因此成本费用类账户的记账规则跟资产类一样：增加记为借，减少或者转销记为贷&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;按照企业会计制度的规定，损益类账户的科目余额，应该结转入利润分配科目，期末余额为零，为虚账户&lt;/li&gt;
&lt;li&gt;在本案例中，损益类账户包括

&lt;ul&gt;
&lt;li&gt;主营业务收入，这是总分类账户&lt;/li&gt;
&lt;li&gt;主营业务收入-会员卡，针对会员卡业务的收入&lt;/li&gt;
&lt;li&gt;营销费用，这是总分类账户&lt;/li&gt;
&lt;li&gt;营销费用-优惠券，用来跟踪优惠券相关的支出&lt;/li&gt;
&lt;li&gt;渠道费用，这是总分类账户&lt;/li&gt;
&lt;li&gt;渠道费用-工行： 用来跟踪在工行的渠道费用支出&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;4-1-5-成本类账户&#34;&gt;4.1.5 成本类账户&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;有成本核算的企业需要设立的账户，包括生产成本、劳务成本等，本文暂不涉及&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;4-1-6-共同类账户&#34;&gt;4.1.6 共同类账户&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;这是反映特殊经济业务的账户，本文暂不涉及&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;4-1-7-账户体系&#34;&gt;4.1.7 账户体系&lt;/h3&gt;

&lt;p&gt;&lt;img src=&#34;https://xueqing.github.io/blog/o2o/支付系统/re&#39;f/accountant_system.jpg&#34; alt=&#34;账户体系&#34; /&gt;&lt;/p&gt;

&lt;h2 id=&#34;4-2-账户结构&#34;&gt;4.2 账户结构&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;采用复式借贷记账法。对于分户账，或者说明细账，如下示例
&lt;img src=&#34;https://xueqing.github.io/blog/o2o/支付系统/ref/detailed_record.jpg&#34; alt=&#34;分户账&#34; /&gt;&lt;/li&gt;
&lt;li&gt;在这个实例中，账户中账务相关的结构包括

&lt;ul&gt;
&lt;li&gt;账户名称：如上述的“应收账款-工行收款”&lt;/li&gt;
&lt;li&gt;会计分录： 除了登记借方金额、贷方金额，还需更新账户余额&lt;/li&gt;
&lt;li&gt;期末借方余额、期末贷方余额、期末余额：按期定时计算。在日切时，计算日发生额和余额。在按月、季度和年作为会计周期时也采用类似的方法处理。 除了日切是必须的，其它时间段的处理是根据财务需要来实现&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;在实现上，账户的各个属性更新时间并不一致，所以在设计账户表的时候，可以按照更新时机来划分表
&lt;img src=&#34;https://xueqing.github.io/blog/o2o/支付系统/ref/pay_accountant.jpg&#34; alt=&#34;支付账户&#34; /&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;4-3-支付流程&#34;&gt;4.3 支付流程&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;接着之前的小明购买会员卡的案例，不考虑优惠券和卡采购的情况，会计分录：&lt;/p&gt;

&lt;p&gt;借：
    应收账款-工行收款 100-100*0.1% = 99.9
    服务成本-工行手续费 100*0.1% = 0.1
  贷：主营业务收入-会员卡 100&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;在线上的实时处理流程如下&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;1 用户购买会员卡，提交订单，会员卡向订单系统请求生成订单，订单系统向支付系统发出支付请求&lt;/li&gt;
&lt;li&gt;2 支付系统生成支付记录，并向银行发出请求&lt;/li&gt;
&lt;li&gt;3 银行实时从小明的银行卡账户上扣款 100 元，通知支付系统小明支付成功&lt;/li&gt;
&lt;li&gt;4 支付系统账务子系统在自己的账户体系中记录小明的这一笔消费支出，给会员卡业务账户增加对应的资金，通知会员卡系统发送卡给小明&lt;/li&gt;
&lt;li&gt;5 支付系统发送消息异步通知会计系统进行记账&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;这 5 个步骤都是线上的流程，在此过程中，各个子系统之间的交互如下图所示
&lt;img src=&#34;https://xueqing.github.io/blog/o2o/支付系统/ref/record_process.jpg&#34; alt=&#34;记账流程&#34; /&gt;&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;4-4-支付订单&#34;&gt;4.4 支付订单&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;这个流程中，首先生成的是支付订单。这是一个比较简单的订单，仅涉及到一个商家和一个商品&lt;/li&gt;
&lt;li&gt;在比较复杂的电商场景中，一个订单会涉及到多个商家、多种商品以及对应的优惠活动。也就是，一个总订单会被拆分为多个子订单&lt;/li&gt;
&lt;li&gt;而订单中和资金相关的内容，都需要在账户体系中建立对应的科目和账户。在请求支付时，只会将总订单提交支付，拆分子订单是在订单系统中完成的
&lt;img src=&#34;https://xueqing.github.io/blog/o2o/支付系统/ref/total_account_record.jpg&#34; alt=&#34;总订单&#34; /&gt;&lt;/li&gt;
&lt;li&gt;针对上述场景，为了简化处理，假定老熊公司当天总共完成了三笔会员卡交易，支付订单如下
&lt;img src=&#34;https://xueqing.github.io/blog/o2o/支付系统/ref/pay_account_record.jpg&#34; alt=&#34;支付订单&#34; /&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;4-5-支付记录&#34;&gt;4.5 支付记录&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;在这个流程中，订单系统向支付系统请求支付时，支付系统将产生支付记录(支付订单)&lt;/li&gt;
&lt;li&gt;支付记录内容比较多，这些数据是后续进行记账的基础
&lt;img src=&#34;https://xueqing.github.io/blog/o2o/支付系统/ref/pay_record.jpg&#34; alt=&#34;支付记录&#34; /&gt;&lt;/li&gt;
&lt;li&gt;上述的三个订单，两笔通过工行支付，一笔通过支付宝支付，其产生的支付记录如下，此处省略了其他和记账无关的字段内容
&lt;img src=&#34;https://xueqing.github.io/blog/o2o/支付系统/ref/pay_record_table.jpg&#34; alt=&#34;支付记录表&#34; /&gt;&lt;/li&gt;
&lt;li&gt;这里需要注意的几个属性

&lt;ul&gt;
&lt;li&gt;订单号: 这是总订单号。支付系统不再对订单进行拆分。订单拆分是订单系统的功能&lt;/li&gt;
&lt;li&gt;支付流水号：在支付记录中，针对每个(总)订单号，会有对应的支付流水号。如果用户使用组合支付，如上述场景，小明使用余额支付了 20 元，使用银行卡支付了剩余的 80 元，那这将产生 2 个支付流水号。为了避免洗钱风险，简化订单处理，包括淘宝在内，现在一般都不再提供组合支付的支持&lt;/li&gt;
&lt;li&gt;支付方式和支付渠道：用户选择的支付方式和实际执行支付的渠道可以是不一样的。比如用户选择了广发信用卡来支付，但实际上电商公司没有直接对接农行，而是通过支付宝来对接，那对应的支付渠道就是支付宝&lt;/li&gt;
&lt;li&gt;本条记录在支付成功后，会产生记账凭证和对账凭证&lt;/li&gt;
&lt;li&gt;这一条记录将产生多条会计分录，记账凭证是关联这些会计分录和支付记录的字段&lt;/li&gt;
&lt;li&gt;对账凭证是根据对账周期来分配的。在日切后，对账凭证号相应的也会做更新&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;在产生支付记录后，在上述流程的第 5 步通过消息机制来异步触发记账流程。账务系统接收到记账消息后，开始更新账户信息。记账分为两个阶段

&lt;ul&gt;
&lt;li&gt;支付记账：针对线上的账户实时更新的需求，需要让用户及时看到账户余额和订单状态，账务信息记录到用户和商户上，采用单边账的形式&lt;/li&gt;
&lt;li&gt;会计记账：采用复式记帐法，满足会计记账需求，记录会计分录和余额，为对账和清结算提供支持&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;4-6-支付记账&#34;&gt;4.6 支付记账&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;支付记账是在支付流程中完成的，目的是让用户完成购买后，能够立即看到支付结果和账户余额。为了提升性能，支付记账一般采用单边账的形式，即将会计分录登记在用户侧或者商户侧&lt;/li&gt;
&lt;li&gt;在上述案例中，第 6 步处理，在服务器上与银行侧同步登记一笔从小明银行卡的支出，并在会员业务账户上登记一笔收入。如果使用的是零钱支付，这一个步骤就很重要，从零钱账户上扣除费用计算余额，添加对应的消费记录，是在一个事务中完成&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;4-7-会计记账&#34;&gt;4.7 会计记账&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;会计记账采用复式记账，不同业务记账方式也不一样。小明买卡的案例中，需要记录的条目有

&lt;ul&gt;
&lt;li&gt;在工行收款账户下，登记 99.9 元的借记条目&lt;/li&gt;
&lt;li&gt;在工行手续费的账户下，登记 0.1 元的借记条目&lt;/li&gt;
&lt;li&gt;在主营业务收入-会员卡的账户下，登记 100 元的贷记条目&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;这 3 条记录是通过事务处理一次生成。当天发生的三笔交易，产生的记账内容如下
&lt;img src=&#34;https://xueqing.github.io/blog/o2o/支付系统/ref/accountant_content.jpg&#34; alt=&#34;记账内容&#34; /&gt;&lt;/li&gt;
&lt;li&gt;实际实现上，科目一列，使用账号 ID 来替代。每个账户的本期发生额，可以在另一个表中单独异步计算&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;4-8-对账&#34;&gt;4.8 对账&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;在会计上，对账分三个部分：账证核对、账账核对和账实核对，做到账证相符、账账相符和账实相符&lt;/li&gt;
&lt;li&gt;在电商支付系统中，需要完成的对账工作包括内部对账、外部对账和资金对账。其中外部对账又分为和支付渠道的对账、和商户的对账以及和用户的对账
&lt;img src=&#34;https://xueqing.github.io/blog/o2o/支付系统/ref/checking.jpg&#34; alt=&#34;对账&#34; /&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;4-8-1-内部对账&#34;&gt;4.8.1 内部对账&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;内部对账的内容包括

&lt;ul&gt;
&lt;li&gt;核实账户系统中的账务与支付记录的一致性&lt;/li&gt;
&lt;li&gt;核实会计系统中的账务与支付记录的一致性&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;这是后续账账核对和账实核对的基础，也是对外对账的基础。这两个对账任务一般是在后台定时运行(5分钟运行一次)，除非系统有 bug 或者发生故障，内部对账一般不会出现差错。如有差错，也需要人工处理&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;4-8-2-渠道对账&#34;&gt;4.8.2 渠道对账&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;一般银行、第三方支付提供 T+1 的对账单，这是执行渠道对账的依据&lt;/li&gt;
&lt;li&gt;在上述案例中，支付系统每天拉取工行前一天的对账单，核对交易流水。与此同时，按照从工行获取的对账单，记录资金归集的账务&lt;/li&gt;
&lt;li&gt;接收到工行对账单后，按照对账单生成凭证
&lt;img src=&#34;https://xueqing.github.io/blog/o2o/支付系统/ref/voucher.jpg&#34; alt=&#34;凭证&#34; /&gt;&lt;/li&gt;
&lt;li&gt;注意上述的日期、凭证号，以及借贷关系&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;4-8-3-账账核对&#34;&gt;4.8.3 账账核对&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;完成渠道对账后，需要进行日结和试算平衡

&lt;ul&gt;
&lt;li&gt;总分类账各账户本期借方发生额合计与贷方余额合计是否相等&lt;/li&gt;
&lt;li&gt;总分类账各账户借方余额合计与贷方发生额合计是否相符&lt;/li&gt;
&lt;li&gt;核对各种明细账及现金、银行存款日记账的本期发生额及期末余额同总分类账中有关账户的余额是否相等&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;从科目维度，计算

&lt;ul&gt;
&lt;li&gt;科目期初余额+科目当日发生额=科目期末余额&lt;/li&gt;
&lt;li&gt;下级科目余额总和=上级科目余额(科目总分检查)&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;4-8-4-账实核对&#34;&gt;4.8.4 账实核对&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;对电商公司来说，最重要的账实核对，是验证银行存款的变化和实际资金流向是一致的。一般是需要登录到银行网银系统中来人工核实&lt;/li&gt;
&lt;li&gt;如果对接的银行多，银行提供网银对账单，也可以自动进行，查询出入款总额&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;4-9-结束语&#34;&gt;4.9 结束语&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;本文主要介绍支付清结算中的账户和账务的处理。清结算是一个很专业的话题，这个专业不是计算机专业，而是会计专业。每个公司的账户和账务处理都有自己的要求和特点&lt;/li&gt;
&lt;li&gt;这一系列文章，主要是从软件开发的角度来协助大家梳理清结算相关的基础知识。具体的账户、账务、会计处理流程，需要和公司会计详细沟通&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
  </channel>
</rss>
